import{n as T,f as U,r as i,j as e,w as C,a as q,v as B,N as G}from"./index-CH_EXTVi.js";import{a as o}from"./coursesApi-Czn4Ryl2.js";import{S as L}from"./SkillSelector-SLj7FoUQ.js";import{G as S}from"./grip-vertical-D6gg4hmE.js";import{T as _}from"./trash-2-CEmDLHiu.js";import{C as z}from"./chevron-up-DJPPnxlv.js";import"./loader-2-DMEWPFv_.js";const Q=()=>{const{id:s}=T(),h=U(),n=!!s,[u,y]=i.useState("info"),[a,l]=i.useState({id:"",title:"",description:"",short_description:"",level:"beginner",skills:[],tags:[],requirements:[],objectives:[],is_premium:!1,price:0,related_skills:[]}),[O,M]=i.useState(null),[x,p]=i.useState([]),[k,j]=i.useState(new Set),[$,v]=i.useState(!1),[f,N]=i.useState(!1);i.useEffect(()=>{n&&s&&g()},[s]);const g=async()=>{try{v(!0);const t=await o.getCourse(s);l({...t,related_skills:t.related_skills||[]}),M(t),p(t.modules||[])}catch(t){alert(`Failed to load course: ${t.message}`)}finally{v(!1)}},w=async()=>{if(!s)return;const t=`module-${Date.now()}`,d={id:t,title:`Module ${x.length+1}`,description:"",order_index:x.length,estimated_minutes:30};try{await o.addModule(s,d),await g(),j(r=>new Set([...r,t]))}catch(r){alert(`Failed to add module: ${r.message}`)}},D=async t=>{if(!(!s||!confirm("Delete this module and all its sections?")))try{await o.deleteModule(s,t),await g()}catch(d){alert(`Failed to delete module: ${d.message}`)}},F=async(t,d)=>{if(s)try{await o.updateModule(s,t,d),p(r=>r.map(c=>c.id===t?{...c,...d}:c))}catch(r){alert(`Failed to update module: ${r.message}`)}},m=async t=>{if(!s)return;const r=x.find(b=>b.id===t)?.sections?.length||0,c={id:`section-${Date.now()}`,title:`Section ${r+1}`,description:"",type:"theory",content_blocks:[],order_index:r,points:10};try{await o.addSection(s,t,c),await g()}catch(b){alert(`Failed to add section: ${b.message}`)}},A=async(t,d)=>{if(!(!s||!confirm("Delete this section?")))try{await o.deleteSection(s,t,d),await g()}catch(r){alert(`Failed to delete section: ${r.message}`)}},P=t=>{j(d=>{const r=new Set(d);return r.has(t)?r.delete(t):r.add(t),r})},E=async()=>{try{N(!0),n?await o.updateCourse(s,a):await o.createCourse(a),h("/admin/courses")}catch(t){alert(`Failed to save course: ${t.message}`)}finally{N(!1)}};return $?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:n?"Edit Course":"Create New Course"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:n?"Update course details and manage content":"Create a new course with content blocks"})]}),n&&e.jsx("div",{className:"mb-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>y("info"),className:`py-4 px-1 border-b-2 font-medium text-sm ${u==="info"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Course Info"}),e.jsxs("button",{onClick:()=>y("modules"),className:`py-4 px-1 border-b-2 font-medium text-sm ${u==="modules"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["Modules & Content (",x.length,")"]})]})}),n&&u==="modules"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Course Modules"}),e.jsxs("button",{onClick:w,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(C,{className:"w-4 h-4"}),"Add Module"]})]}),x.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg",children:[e.jsx(q,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"No modules yet"}),e.jsx("button",{onClick:w,className:"text-blue-600 hover:text-blue-700 font-medium",children:"+ Add your first module"})]}):e.jsx("div",{className:"space-y-4",children:x.sort((t,d)=>t.order_index-d.order_index).map((t,d)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 dark:bg-gray-700 cursor-pointer",onClick:()=>P(t.id),children:[e.jsx(S,{className:"w-5 h-5 text-gray-400 cursor-grab"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"text",value:t.title,onChange:r=>F(t.id,{title:r.target.value}),onClick:r=>r.stopPropagation(),className:"font-medium text-gray-900 dark:text-white bg-transparent border-none focus:outline-none focus:ring-2 focus:ring-blue-500 rounded px-2 -ml-2"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.sections?.length||0," sections â€¢ ",t.estimated_minutes||0," min"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),m(t.id)},className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded",title:"Add Section",children:e.jsx(C,{className:"w-4 h-4"})}),e.jsx("button",{onClick:r=>{r.stopPropagation(),D(t.id)},className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:"Delete Module",children:e.jsx(_,{className:"w-4 h-4"})}),k.has(t.id)?e.jsx(z,{className:"w-5 h-5 text-gray-400"}):e.jsx(B,{className:"w-5 h-5 text-gray-400"})]})]}),k.has(t.id)&&e.jsx("div",{className:"p-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700",children:!t.sections||t.sections.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500 dark:text-gray-400",children:[e.jsx(G,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No sections yet"}),e.jsx("button",{onClick:()=>m(t.id),className:"text-blue-600 text-sm hover:underline mt-2",children:"+ Add section"})]}):e.jsxs("div",{className:"space-y-2",children:[t.sections.sort((r,c)=>r.order_index-c.order_index).map(r=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx(S,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${r.type==="theory"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":r.type==="practice"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":r.type==="quiz"?"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400":"bg-gray-100 text-gray-700 dark:bg-gray-600 dark:text-gray-300"}`,children:r.type}),e.jsx("span",{className:"flex-1 text-sm text-gray-700 dark:text-gray-300",children:r.title}),e.jsxs("span",{className:"text-xs text-gray-500",children:[r.content_blocks?.length||0," blocks"]}),e.jsx("button",{onClick:()=>A(t.id,r.id),className:"p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",children:e.jsx(_,{className:"w-4 h-4"})})]},r.id)),e.jsx("button",{onClick:()=>m(t.id),className:"w-full py-2 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-500 dark:text-gray-400 hover:border-blue-400 hover:text-blue-500 text-sm",children:"+ Add Section"})]})})]},t.id))}),e.jsx("div",{className:"mt-6 p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-400",children:[e.jsx("strong",{children:"Coming Soon:"})," Full content block editor for sections. Currently you can manage course structure - content editing will be available in the next update."]})})]}),(!n||u==="info")&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 space-y-6",children:[!n&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Course ID"}),e.jsx("input",{type:"text",value:a.id,onChange:t=>l({...a,id:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"e.g., python-fundamentals"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Title"}),e.jsx("input",{type:"text",value:a.title,onChange:t=>l({...a,title:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:t=>l({...a,description:t.target.value}),rows:4,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Short Description"}),e.jsx("input",{type:"text",value:a.short_description,onChange:t=>l({...a,short_description:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Difficulty Level"}),e.jsxs("select",{value:a.level,onChange:t=>l({...a,level:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category"}),e.jsx("input",{type:"text",value:a.category||"",onChange:t=>l({...a,category:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"e.g., Programming"})]}),e.jsx("div",{children:e.jsx(L,{selectedSlugs:a.related_skills||[],onChange:t=>l({...a,related_skills:t}),helpText:"Skills that will receive XP when course modules are completed"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.is_premium,onChange:t=>l({...a,is_premium:t.target.checked}),className:"mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Premium Course"})]})}),a.is_premium&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Price (USD)"}),e.jsx("input",{type:"number",value:a.price,onChange:t=>l({...a,price:parseFloat(t.target.value)}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>h("/admin/courses"),className:"px-6 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:E,disabled:f,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:f?"Saving...":n?"Update Course":"Create Course"})]})]})]})})};export{Q as default};
