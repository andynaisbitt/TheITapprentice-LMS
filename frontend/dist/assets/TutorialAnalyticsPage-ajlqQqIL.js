import{f as N,r as i,j as e}from"./index-CH_EXTVi.js";import{f as v,j as w}from"./tutorialApi-DNKublxO.js";const L=()=>{const u=N(),[d,n]=i.useState([]),[b,x]=i.useState(!0),[g,m]=i.useState(null),[c,o]=i.useState("views"),[r,h]=i.useState(null);i.useEffect(()=>{y()},[]);const y=async()=>{try{x(!0),m(null);const t=await v({limit:100});n(t)}catch(t){console.error("Error fetching tutorials:",t),m(t.message||"Failed to load tutorials")}finally{x(!1)}},p=async t=>{n(a=>a.map(s=>s.id===t?{...s,loadingAnalytics:!0}:s));try{const a=await w(t);n(s=>s.map(l=>l.id===t?{...l,analytics:a,loadingAnalytics:!1}:l))}catch(a){console.error("Error loading analytics:",a),n(s=>s.map(l=>l.id===t?{...l,loadingAnalytics:!1}:l))}},j=t=>{!t.analytics&&!t.loadingAnalytics&&p(t.id),h(t)},k=()=>{h(null)},f=[...d].sort((t,a)=>{switch(c){case"views":return a.view_count-t.view_count;case"completions":return a.completion_count-t.completion_count;case"completion_rate":const s=t.analytics?.completion_rate||0;return(a.analytics?.completion_rate||0)-s;default:return 0}});return b?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):g?e.jsx("div",{className:"p-6 max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-red-600 dark:text-red-400",children:g}),e.jsx("button",{onClick:y,className:"mt-2 text-sm text-red-700 dark:text-red-300 hover:underline",children:"Try Again"})]})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Tutorial Analytics"}),e.jsx("p",{className:"mt-1 text-gray-600 dark:text-gray-400",children:"Performance metrics and insights for all tutorials"})]}),e.jsx("button",{onClick:()=>u("/admin/tutorials"),className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:"Back to Management"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Tutorials"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-2",children:d.length})]}),e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-full",children:e.jsx("svg",{className:"w-8 h-8 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border-l-4 border-green-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Views"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-2",children:d.reduce((t,a)=>t+a.view_count,0).toLocaleString()})]}),e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-full",children:e.jsxs("svg",{className:"w-8 h-8 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border-l-4 border-purple-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Completions"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-2",children:d.reduce((t,a)=>t+a.completion_count,0).toLocaleString()})]}),e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900/30 rounded-full",children:e.jsx("svg",{className:"w-8 h-8 text-purple-600 dark:text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"})})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border-l-4 border-orange-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Published"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-2",children:d.filter(t=>t.is_published).length})]}),e.jsx("div",{className:"p-3 bg-orange-100 dark:bg-orange-900/30 rounded-full",children:e.jsx("svg",{className:"w-8 h-8 text-orange-600 dark:text-orange-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Sort by:"}),e.jsx("button",{onClick:()=>o("views"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c==="views"?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"Views"}),e.jsx("button",{onClick:()=>o("completions"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c==="completions"?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"Completions"}),e.jsx("button",{onClick:()=>o("completion_rate"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c==="completion_rate"?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"Completion Rate"})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Tutorial"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Difficulty"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Views"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Completions"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:f.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[t.thumbnail_url&&e.jsx("img",{src:t.thumbnail_url,alt:t.title,className:"w-16 h-12 object-cover rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-1",children:t.description}),t.category&&e.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 text-xs rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300",children:t.category.name})]})]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:`inline-block px-2 py-1 text-xs font-medium rounded-full ${t.difficulty==="beginner"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":t.difficulty==="intermediate"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300"}`,children:t.difficulty})}),e.jsx("td",{className:"px-6 py-4 text-center text-gray-900 dark:text-white font-medium",children:t.view_count.toLocaleString()}),e.jsx("td",{className:"px-6 py-4 text-center text-gray-900 dark:text-white font-medium",children:t.completion_count.toLocaleString()}),e.jsx("td",{className:"px-6 py-4 text-center",children:t.is_published?e.jsx("span",{className:"inline-block px-2 py-1 text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-full",children:"Published"}):e.jsx("span",{className:"inline-block px-2 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 rounded-full",children:"Draft"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("button",{onClick:()=>j(t),className:"px-3 py-1 text-sm text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors",children:"View Details"})})]},t.id))})]})}),d.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No tutorials found. Create your first tutorial to see analytics."})})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Detailed Analytics"})]}),e.jsx("button",{onClick:k,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-6 h-6 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-6 space-y-6",children:r.loadingAnalytics?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):r.analytics?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Views"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:r.analytics.total_views.toLocaleString()})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Starts"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:r.analytics.total_starts.toLocaleString()})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Completions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:r.analytics.total_completions.toLocaleString()})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Completion Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:[(r.analytics.completion_rate*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Avg Time"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:r.analytics.average_time_minutes?`${r.analytics.average_time_minutes.toFixed(0)}m`:"N/A"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"XP Reward"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:r.xp_reward})]})]}),r.analytics.step_dropoff_rates.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Step-by-Step Analysis"}),e.jsx("div",{className:"space-y-3",children:r.analytics.step_dropoff_rates.map(t=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:t.step_title}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t.completions," completions"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-gray-600 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${Math.max(0,100-t.dropoff_rate*100)}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[(t.dropoff_rate*100).toFixed(1),"% dropoff"]})]})]},t.step_id))})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Failed to load analytics. Please try again."}),e.jsx("button",{onClick:()=>p(r.id),className:"mt-4 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Retry"})]})})]})})]})};export{L as TutorialAnalyticsPage,L as default};
