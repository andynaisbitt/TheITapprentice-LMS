import{c as v,r as s,g as b,j as e,x as i,O as L,q as P,L as j,E as _,a1 as C}from"./index-CJMQzWwg.js";import{L as p}from"./loader-2-DzYHjI--.js";import{R as S}from"./refresh-cw-CjDnXyeW.js";const E=v("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]),R=v("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),F=()=>{const[n,c]=s.useState([]),[u,o]=s.useState(!0),[x,m]=s.useState(null),[g,h]=s.useState(null),[N,y]=s.useState(0),[f,k]=s.useState(0);s.useEffect(()=>{d()},[]);const d=async()=>{o(!0),h(null);try{const t=await b.get("/api/v1/admin/plugins");c(t.data.plugins),y(t.data.total_enabled),k(t.data.total_available)}catch(t){console.error("Failed to load plugins:",t),h(t.response?.data?.detail||"Failed to load plugins")}finally{o(!1)}},w=async(t,a)=>{m(t);try{(await b.put(`/api/v1/admin/plugins/${t}/toggle`,{enabled:!a})).data.success&&(c(n.map(r=>r.id===t?{...r,enabled:!a,status:a?"inactive":"active"}:r)),y(r=>a?r-1:r+1))}catch(l){console.error("Failed to toggle plugin:",l),alert(l.response?.data?.detail||"Failed to toggle plugin")}finally{m(null)}};return u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(p,{className:"w-8 h-8 animate-spin text-primary"})}):g?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{className:"w-5 h-5 text-red-600"}),e.jsx("p",{className:"text-red-800 dark:text-red-200",children:g})]}),e.jsx("button",{onClick:d,className:"mt-3 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Retry"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Plugin Manager"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Enable or disable plugins to customize your platform"})]}),e.jsx("button",{onClick:d,className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",title:"Refresh",children:e.jsx(S,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg",children:e.jsx(L,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[N," / ",f]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Plugins Active"})]})]}),e.jsx("div",{className:"space-y-4",children:n.map(t=>e.jsx("div",{className:`
              bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6
              border-l-4 transition-all duration-200
              ${t.enabled?"border-green-500":"border-gray-300 dark:border-gray-600"}
            `,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.name}),e.jsxs("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:["v",t.version]}),t.status==="active"&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx(P,{className:"w-3 h-3"}),"Active"]}),t.status==="error"&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-red-600 dark:text-red-400",children:[e.jsx(i,{className:"w-3 h-3"}),"Error"]})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:t.description}),t.enabled&&t.stats&&Object.keys(t.stats).length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-4",children:Object.entries(t.stats).map(([a,l])=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 capitalize",children:[a.replace(/_/g," "),":"]})," ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:l})]},a))}),t.enabled&&t.public_routes.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:t.public_routes.map(a=>e.jsxs(j,{to:a,className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors",children:[a,e.jsx(_,{className:"w-3 h-3"})]},a))})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.enabled&&t.has_admin_ui&&t.admin_route&&e.jsx(j,{to:t.admin_route,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",title:"Plugin settings",children:e.jsx(C,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>w(t.id,t.enabled),disabled:x===t.id,className:"relative",children:x===t.id?e.jsx(p,{className:"w-8 h-8 animate-spin text-primary"}):t.enabled?e.jsx(R,{className:"w-10 h-10 text-green-500 hover:text-green-600 transition-colors"}):e.jsx(E,{className:"w-10 h-10 text-gray-400 hover:text-gray-500 transition-colors"})})]})]})},t.id))}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(i,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200 font-medium",children:"Note: Plugin changes require a server restart"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:"After toggling plugins, restart the backend server for route changes to take effect. The plugin enabled state is saved to the database immediately."})]})]})})]})};export{F as PluginManager,F as default};
