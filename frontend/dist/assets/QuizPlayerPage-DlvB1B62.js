import{o as R,f as B,u as T,r as i,j as e,L as v}from"./index-smch1bU1.js";import{c as E,d as F,e as I,s as O,f as W}from"./useQuizzes-BbP-pkY_.js";import{R as Y}from"./RegistrationPrompt-CfFLfNUY.js";import{u as X}from"./useRegistrationPrompt-CIWAgZXh.js";import"./log-in-nT5SABG_.js";const D={easy:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",hard:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400",expert:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"},Z=()=>{const{quizId:c}=R();B();const{isAuthenticated:l}=T(),{isPromptOpen:o,closePrompt:g,handleSkip:s,checkAuthAndProceed:y}=X({context:"quiz",onSkip:()=>{}}),{quiz:t,loading:Q,error:q}=E(c),{leaderboard:f}=F(c),{attempts:_,refetch:z}=I(c),[u,N]=i.useState("overview"),[p,k]=i.useState(0),[h,w]=i.useState({}),[x,S]=i.useState(null),[d,C]=i.useState(null),[j,$]=i.useState(!1);i.useEffect(()=>{if(u!=="playing"||x===null||x<=0)return;const r=setInterval(()=>{S(n=>n===null||n<=0?(clearInterval(r),0):n-1)},1e3);return()=>clearInterval(r)},[u,x]),i.useEffect(()=>{x===0&&u==="playing"&&A()},[x,u]);const P=i.useCallback(async()=>{if(t&&y())try{await O(t.id),N("playing"),k(0),w({}),t.time_limit_minutes&&S(t.time_limit_minutes*60)}catch(r){alert(r.response?.data?.detail||"Failed to start quiz")}},[t,y]),M=i.useCallback((r,n)=>{w(a=>({...a,[r.toString()]:n}))},[]),A=i.useCallback(async()=>{if(!(!t||j)){$(!0);try{const r=await W(t.id,{answers:h});C(r),N("results"),z()}catch(r){alert(r.response?.data?.detail||"Failed to submit quiz")}finally{$(!1)}}},[t,h,j,z]),L=r=>{const n=Math.floor(r/60),a=r%60;return`${n}:${a.toString().padStart(2,"0")}`};if(Q)return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})});if(q||!t)return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Quiz Not Found"}),e.jsx(v,{to:"/quizzes",className:"text-purple-600 hover:underline",children:"Back to Quizzes"})]})});if(u==="overview"){const r=_.find(a=>a.is_complete),n=t.max_attempts===0||_.filter(a=>a.is_complete).length<t.max_attempts;return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsxs(v,{to:"/quizzes",className:"inline-flex items-center text-purple-600 dark:text-purple-400 hover:underline mb-6",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Quizzes"]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-8",children:[e.jsx("div",{className:"h-2 bg-gradient-to-r from-purple-500 to-indigo-600"}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[t.category&&e.jsx("span",{className:"px-3 py-1 text-sm font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full",children:t.category}),e.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${D[t.difficulty]}`,children:t.difficulty.charAt(0).toUpperCase()+t.difficulty.slice(1)})]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:t.title}),t.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:t.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t.question_count}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Questions"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t.time_limit_minutes?`${t.time_limit_minutes}m`:"None"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Time Limit"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[t.passing_score,"%"]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Pass Score"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:t.xp_reward}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"XP Reward"})]})]}),t.instructions&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"font-medium text-purple-800 dark:text-purple-200 mb-2",children:"Instructions"}),e.jsx("p",{className:"text-purple-700 dark:text-purple-300 text-sm",children:t.instructions})]}),r&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Your Best Attempt"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:`text-lg font-bold ${r.passed?"text-green-600":"text-red-600"}`,children:[r.percentage.toFixed(0),"%"]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${r.passed?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}`,children:r.passed?"PASSED":"FAILED"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Attempt #",r.attempt_number]})]})]}),n?e.jsx("button",{onClick:P,className:"w-full md:w-auto px-8 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-medium rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all",children:r?"Retry Quiz":"Start Quiz"}):l&&e.jsxs("div",{className:"text-center py-4 text-gray-600 dark:text-gray-400",children:["Maximum attempts (",t.max_attempts,") reached"]}),!l&&e.jsx("p",{className:"mt-3 text-sm text-gray-500 dark:text-gray-400 text-center",children:"Sign up to save your quiz results and earn XP"})]})]}),f&&f.entries.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Leaderboard"}),e.jsx("div",{className:"space-y-2",children:f.entries.slice(0,5).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`w-8 h-8 flex items-center justify-center rounded-full font-bold ${a.rank===1?"bg-yellow-400 text-yellow-900":a.rank===2?"bg-gray-300 text-gray-700":a.rank===3?"bg-orange-400 text-orange-900":"bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300"}`,children:a.rank}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:a.display_name||a.username})]}),e.jsxs("span",{className:"font-bold text-purple-600 dark:text-purple-400",children:[a.best_score.toFixed(0),"%"]})]},a.user_id))})]}),e.jsx(Y,{isOpen:o,onClose:g,onSkip:s,context:"quiz"})]})})}if(u==="playing"){const r=t.questions[p],n=Object.keys(h).length,a=(p+1)/t.questions.length*100;return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"sticky top-0 bg-white dark:bg-gray-800 shadow-md z-10",children:e.jsxs("div",{className:"container mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h1",{className:"font-bold text-gray-900 dark:text-white truncate max-w-xs",children:t.title}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Question ",p+1," of ",t.questions.length]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[x!==null&&e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full ${x<60?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":x<300?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}`,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-mono font-medium",children:L(x)})]}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[n,"/",t.questions.length," answered"]})]})]}),e.jsx("div",{className:"mt-3 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-indigo-600 transition-all duration-300",style:{width:`${a}%`}})})]})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-3xl",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsxs("span",{className:"px-3 py-1 text-sm font-medium bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300 rounded-full",children:[r.points," point",r.points!==1?"s":""]}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400 capitalize",children:r.question_type.replace("_"," ")})]}),r.image_url&&e.jsx("img",{src:r.image_url,alt:"Question",className:"max-w-full h-auto rounded-lg mb-4"}),e.jsx("h2",{className:"text-xl font-medium text-gray-900 dark:text-white",children:r.question_html?e.jsx("div",{dangerouslySetInnerHTML:{__html:r.question_html}}):r.question_text})]}),e.jsx(J,{question:r,value:h[r.id.toString()],onChange:m=>M(r.id,m)})]}),e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsx("button",{onClick:()=>k(m=>Math.max(0,m-1)),disabled:p===0,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("div",{className:"flex gap-2",children:t.questions.map((m,b)=>e.jsx("button",{onClick:()=>k(b),className:`w-8 h-8 rounded-full text-sm font-medium transition-colors ${b===p?"bg-purple-600 text-white":h[t.questions[b].id.toString()]?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:b+1},b))}),p<t.questions.length-1?e.jsx("button",{onClick:()=>k(m=>m+1),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Next"}):e.jsx("button",{onClick:A,disabled:j,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:j?"Submitting...":"Submit Quiz"})]})]})]})}return u==="results"&&d?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-3xl",children:[e.jsx("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-8 ${d.passed?"border-t-4 border-green-500":"border-t-4 border-red-500"}`,children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:`w-24 h-24 mx-auto rounded-full flex items-center justify-center mb-6 ${d.passed?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"}`,children:d.passed?e.jsx("svg",{className:"w-12 h-12 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"w-12 h-12 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:d.passed?"Congratulations!":"Keep Trying!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:d.passed?"You passed the quiz!":`You need ${t.passing_score}% to pass.`}),e.jsx("div",{className:"text-5xl font-bold mb-4",children:e.jsxs("span",{className:d.passed?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:[d.percentage.toFixed(0),"%"]})}),e.jsxs("div",{className:"flex justify-center gap-8 text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[d.score,"/",d.max_score]}),e.jsx("div",{className:"text-sm",children:"Points"})]}),d.time_taken_seconds&&e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:L(d.time_taken_seconds)}),e.jsx("div",{className:"text-sm",children:"Time"})]}),d.xp_awarded>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:["+",d.xp_awarded]}),e.jsx("div",{className:"text-sm",children:"XP Earned"})]})]})]})}),d.show_answers&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6",children:"Question Review"}),e.jsx("div",{className:"space-y-6",children:d.question_results.map((r,n)=>{const a=t.questions.find(m=>m.id===r.question_id);return a?e.jsx("div",{className:`p-4 rounded-lg ${r.correct?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center ${r.correct?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:r.correct?"✓":"✗"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white mb-2",children:[n+1,". ",a.question_text]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:["Your answer: ",e.jsx("span",{className:"font-medium",children:JSON.stringify(r.user_answer)})]}),!r.correct&&r.correct_answer&&e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400",children:["Correct answer: ",e.jsx("span",{className:"font-medium",children:JSON.stringify(r.correct_answer)})]}),r.explanation&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2 italic",children:r.explanation})]})]})},r.question_id):null})})]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:()=>{N("overview"),C(null),w({})},className:"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Try Again"}),e.jsx(v,{to:"/quizzes",className:"px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600",children:"Back to Quizzes"})]})]})}):null},J=({question:c,value:l,onChange:o})=>{switch(c.question_type){case"multiple_choice":return e.jsx("div",{className:"space-y-3",children:c.options.map(s=>e.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer transition-colors ${l===s.id?"border-purple-500 bg-purple-50 dark:bg-purple-900/20":"border-gray-200 dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-700"}`,children:[e.jsx("input",{type:"radio",name:`question-${c.id}`,value:s.id,checked:l===s.id,onChange:()=>o(s.id),className:"sr-only"}),e.jsx("span",{className:`w-5 h-5 rounded-full border-2 mr-3 flex items-center justify-center ${l===s.id?"border-purple-500 bg-purple-500":"border-gray-300 dark:border-gray-600"}`,children:l===s.id&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-white"})}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:s.text})]},s.id))});case"multiple_select":const g=Array.isArray(l)?l:[];return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"Select all that apply"}),c.options.map(s=>e.jsxs("label",{className:`flex items-center p-4 rounded-lg border-2 cursor-pointer transition-colors ${g.includes(s.id)?"border-purple-500 bg-purple-50 dark:bg-purple-900/20":"border-gray-200 dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-700"}`,children:[e.jsx("input",{type:"checkbox",value:s.id,checked:g.includes(s.id),onChange:y=>{y.target.checked?o([...g,s.id]):o(g.filter(t=>t!==s.id))},className:"sr-only"}),e.jsx("span",{className:`w-5 h-5 rounded border-2 mr-3 flex items-center justify-center ${g.includes(s.id)?"border-purple-500 bg-purple-500":"border-gray-300 dark:border-gray-600"}`,children:g.includes(s.id)&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:s.text})]},s.id))]});case"true_false":return e.jsx("div",{className:"flex gap-4",children:["true","false"].map(s=>e.jsx("button",{onClick:()=>o(s),className:`flex-1 py-4 rounded-lg border-2 font-medium transition-colors ${l===s?"border-purple-500 bg-purple-50 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300":"border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:border-purple-300 dark:hover:border-purple-700"}`,children:s==="true"?"True":"False"},s))});case"short_answer":case"fill_blank":return e.jsx("input",{type:"text",value:l||"",onChange:s=>o(s.target.value),placeholder:"Type your answer...",className:"w-full px-4 py-3 rounded-lg border-2 border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-purple-500 focus:outline-none"});case"code":return e.jsxs("div",{children:[c.code_template&&e.jsx("pre",{className:"bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mb-4 text-sm overflow-x-auto",children:e.jsx("code",{children:c.code_template})}),e.jsx("textarea",{value:l||"",onChange:s=>o(s.target.value),placeholder:"Enter your code...",rows:8,className:"w-full px-4 py-3 rounded-lg border-2 border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm focus:border-purple-500 focus:outline-none"})]});default:return e.jsx("input",{type:"text",value:l||"",onChange:s=>o(s.target.value),className:"w-full px-4 py-3 rounded-lg border-2 border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-purple-500 focus:outline-none"})}};export{Z as default};
