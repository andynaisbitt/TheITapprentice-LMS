import{c as Y,f as ee,r,j as e,v as te,w as B,n as se,X as ae,e as re,x as le}from"./index-smch1bU1.js";import{a as u}from"./admin-blog.api-BolBCfzR.js";import{a as ie}from"./admin-category.api-DJSfZaZc.js";import{L as N}from"./loader-2-D9MIupjh.js";import{C as L,S as T}from"./square-DNo4tjry.js";import{E}from"./eye-DJREYbmB.js";import{E as de}from"./eye-off-CwQR6md3.js";import{S as ne}from"./star-BX-qMkwk.js";import{C as oe}from"./calendar-D0h1sdek.js";import{P as ce}from"./pen-square-C1GUdoLG.js";import{T as ge}from"./trash-2-7shbvHm_.js";const xe=Y("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);function Ne(){const j=ee(),[o,U]=r.useState([]),[$,M]=r.useState([]),[O,S]=r.useState(!0),[f,C]=r.useState(""),[h,z]=r.useState("all"),[b,P]=r.useState(null),[c,F]=r.useState(null),[v,A]=r.useState("created_at"),[w,D]=r.useState("desc"),[a,i]=r.useState(new Set),[g,l]=r.useState(!1),[_,m]=r.useState(!1),[k,p]=r.useState({show:!1});r.useEffect(()=>{x()},[]);const x=async()=>{try{S(!0);const[t,s]=await Promise.all([u.getAllPosts(),ie.getAll()]);console.log("Loaded posts:",t),console.log("Posts array:",t.posts),console.log("Posts count:",t.posts?.length||0),U(t.posts||[]),M(s||[])}catch(t){console.error("Failed to load data:",t),console.error("Error response:",t.response),alert(`Failed to load blog posts. Error: ${t.response?.data?.detail||t.message}`)}finally{S(!1)}},d=r.useMemo(()=>{let t=o.filter(s=>{const y=s.title.toLowerCase().includes(f.toLowerCase()),n=h==="all"?!0:h==="published"?s.published:!s.published,J=b===null||s.categories.some(W=>W.id===b),K=c===null||s.is_featured===c;return y&&n&&J&&K});return t.sort((s,y)=>{let n=0;switch(v){case"title":n=s.title.localeCompare(y.title);break;case"view_count":n=s.view_count-y.view_count;break;case"created_at":case"updated_at":n=new Date(s.created_at).getTime()-new Date(y.created_at).getTime();break}return w==="asc"?n:-n}),t},[o,f,h,b,c,v,w]),q=()=>{a.size===d.length?i(new Set):i(new Set(d.map(t=>t.id)))},Q=t=>{const s=new Set(a);s.has(t)?s.delete(t):s.add(t),i(s)},V=async()=>{if(a.size!==0)try{l(!0),await u.bulkUpdate({post_ids:Array.from(a),published:!0}),await x(),i(new Set),m(!1)}catch(t){console.error("Bulk publish failed:",t),alert("Failed to publish selected posts")}finally{l(!1)}},H=async()=>{if(a.size!==0)try{l(!0),await u.bulkUpdate({post_ids:Array.from(a),published:!1}),await x(),i(new Set),m(!1)}catch(t){console.error("Bulk unpublish failed:",t),alert("Failed to unpublish selected posts")}finally{l(!1)}},I=async()=>{if(a.size!==0)try{l(!0),await u.bulkUpdate({post_ids:Array.from(a),is_featured:!0}),await x(),i(new Set),m(!1)}catch(t){console.error("Bulk feature failed:",t),alert("Failed to feature selected posts")}finally{l(!1)}},R=async()=>{if(a.size!==0)try{l(!0),await Promise.all(Array.from(a).map(t=>u.deletePost(t))),await x(),i(new Set),m(!1),p({show:!1})}catch(t){console.error("Bulk delete failed:",t),alert("Failed to delete selected posts")}finally{l(!1)}},X=async t=>{try{l(!0),await u.deletePost(t),await x(),p({show:!1})}catch(s){console.error("Delete failed:",s),alert("Failed to delete post")}finally{l(!1)}},Z=()=>{C(""),z("all"),P(null),F(null),A("created_at"),D("desc")},G=f||h!=="all"||b!==null||c!==null;return O?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50 dark:bg-slate-900",children:e.jsx(N,{className:"animate-spin h-12 w-12 text-blue-600"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-slate-900",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700 sticky top-16 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Blog Posts"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:a.size>0?e.jsxs("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:[a.size," selected"]}):e.jsxs(e.Fragment,{children:[d.length," of ",o.length," posts"]})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[a.size>0&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>m(!_),disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 dark:bg-blue-700 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition font-medium disabled:opacity-50",children:g?e.jsx(N,{className:"animate-spin",size:20}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Bulk Actions"}),e.jsx(te,{size:16})]})}),_&&!g&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-20",children:[e.jsx("button",{onClick:V,className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm text-gray-700 dark:text-gray-300 transition",children:"Publish Selected"}),e.jsx("button",{onClick:H,className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm text-gray-700 dark:text-gray-300 transition",children:"Unpublish Selected"}),e.jsx("button",{onClick:I,className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm text-gray-700 dark:text-gray-300 transition",children:"Feature Selected"}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-2"}),e.jsx("button",{onClick:()=>p({show:!0,isBulk:!0}),className:"w-full text-left px-4 py-2 hover:bg-red-50 dark:hover:bg-red-900/20 text-sm text-red-600 dark:text-red-400 transition",children:"Delete Selected"})]})]}),e.jsxs("button",{onClick:()=>j("/admin/blog"),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 dark:bg-blue-700 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition font-medium",children:[e.jsx(B,{size:20}),e.jsx("span",{children:"New Post"})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow border border-gray-200 dark:border-slate-700 p-4 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500",size:20}),e.jsx("input",{type:"text",placeholder:"Search posts...",value:f,onChange:t=>C(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:h,onChange:t=>z(t.target.value),className:"px-4 py-2 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"published",children:"Published"}),e.jsx("option",{value:"draft",children:"Drafts"})]}),e.jsxs("select",{value:b||"",onChange:t=>P(t.target.value?Number(t.target.value):null),className:"px-4 py-2 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Categories"}),$.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("select",{value:c===null?"":c.toString(),onChange:t=>F(t.target.value===""?null:t.target.value==="true"),className:"px-4 py-2 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Posts"}),e.jsx("option",{value:"true",children:"Featured Only"}),e.jsx("option",{value:"false",children:"Non-Featured"})]}),e.jsxs("select",{value:v,onChange:t=>A(t.target.value),className:"px-4 py-2 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"created_at",children:"Sort by Date"}),e.jsx("option",{value:"title",children:"Sort by Title"}),e.jsx("option",{value:"view_count",children:"Sort by Views"})]}),e.jsxs("select",{value:w,onChange:t=>D(t.target.value),className:"px-4 py-2 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"desc",children:"Descending"}),e.jsx("option",{value:"asc",children:"Ascending"})]})]}),G&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("button",{onClick:Z,className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition",children:[e.jsx(ae,{size:16}),"Clear Filters"]})})]}),d.length===0?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow border border-gray-200 dark:border-slate-700 p-12 text-center",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:o.length===0?"No posts yet":"No matching posts"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:o.length===0?"Create your first blog post":"Try adjusting your filters"}),o.length===0&&e.jsxs("button",{onClick:()=>j("/admin/blog"),className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 dark:bg-blue-700 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition font-medium",children:[e.jsx(B,{size:20}),"Create First Post"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-gray-50 dark:bg-slate-800/50 rounded-lg",children:[e.jsxs("button",{onClick:q,className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition",children:[a.size===d.length?e.jsx(L,{size:20,className:"text-blue-600 dark:text-blue-400"}):e.jsx(T,{size:20}),e.jsx("span",{children:a.size===d.length?"Deselect All":"Select All"})]}),a.size>0&&e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["(",a.size," selected)"]})]}),d.map(t=>e.jsx("div",{className:`bg-white dark:bg-slate-800 rounded-lg shadow hover:shadow-lg transition-all duration-200 p-6 border ${a.has(t.id)?"ring-2 ring-blue-500 border-blue-500":"border-gray-200 dark:border-slate-700"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>Q(t.id),className:"mt-1 flex-shrink-0",children:a.has(t.id)?e.jsx(L,{size:24,className:"text-blue-600 dark:text-blue-400"}):e.jsx(T,{size:24,className:"text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 truncate",children:t.title}),t.published?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 text-xs font-medium rounded",children:[e.jsx(E,{size:14}),"Published"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300 text-xs font-medium rounded",children:[e.jsx(de,{size:14}),"Draft"]}),t.is_featured&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 text-xs font-medium rounded",children:[e.jsx(ne,{size:14}),"Featured"]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-3 line-clamp-2",children:t.excerpt}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-600 dark:text-gray-400 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{size:14}),new Date(t.created_at).toLocaleDateString()]}),t.categories.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{size:14}),e.jsx("div",{className:"flex gap-1 flex-wrap",children:t.categories.map(s=>e.jsx("span",{className:"px-2 py-0.5 rounded text-xs",style:{backgroundColor:s.color?`${s.color}20`:"#e5e7eb",color:s.color||"#6b7280"},children:s.name},s.id))})]}),t.view_count>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{size:14}),t.view_count.toLocaleString()," views"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>j(`/admin/blog/${t.id}`),className:"p-2 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition",title:"Edit post",children:e.jsx(ce,{size:20})}),e.jsx("button",{onClick:()=>window.open(`/blog/${t.slug}`,"_blank"),className:"p-2 text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition",title:"View post",children:e.jsx(E,{size:20})}),e.jsx("button",{onClick:()=>p({show:!0,postId:t.id}),className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition",title:"Delete post",children:e.jsx(ge,{size:20})})]})]})},t.id))]})]}),k.show&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 rounded-full",children:e.jsx(le,{className:"text-red-600 dark:text-red-400",size:24})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Confirm Deletion"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:k.isBulk?`Are you sure you want to delete ${a.size} selected posts? This action cannot be undone.`:"Are you sure you want to delete this post? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>p({show:!1}),disabled:g,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{onClick:()=>k.isBulk?R():X(k.postId),disabled:g,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition disabled:opacity-50 flex items-center gap-2",children:[g&&e.jsx(N,{className:"animate-spin",size:16}),"Delete"]})]})]})})]})}export{Ne as default};
