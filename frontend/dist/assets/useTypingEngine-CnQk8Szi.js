import{r as e}from"./index-smch1bU1.js";function O(R,j={}){const{onWordComplete:I,onGameComplete:K,onError:V,onKeystroke:P}=j,c=e.useMemo(()=>R.trim().split(/\s+/),[R]),[i,f]=e.useState("idle"),[y,T]=e.useState([]),[a,x]=e.useState(0),[l,k]=e.useState(""),[q,W]=e.useState(0),[M,v]=e.useState(0),g=e.useRef(null),w=e.useRef(null),m=e.useRef(null),C=e.useRef(0),S=e.useRef(0),b=e.useRef(0);e.useEffect(()=>{const t=c.map((s,o)=>({word:s,index:o,status:o===0?"current":"pending",typedValue:"",isCorrect:!1,characterStates:s.split("").map(u=>({char:u,status:"pending",typedChar:void 0}))}));T(t),x(0),k(""),W(0),v(0),C.current=0,S.current=0,b.current=0,g.current=null,w.current=null,m.current=null,f("ready")},[c]);const E=e.useMemo(()=>{const t=g.current?(Date.now()-g.current)/1e3:0,s=y.filter(h=>h.status==="completed"||h.status==="skipped"),o=s.filter(h=>h.isCorrect).length,u=s.filter(h=>!h.isCorrect).length,n=t/60,r=n>0?Math.round(C.current/5/n):0,p=n>0?Math.round(b.current/5/n):0,d=C.current+S.current,D=d>0?Math.round(C.current/d*100):100;return{wpm:r,rawWpm:p,accuracy:D,correctChars:C.current,incorrectChars:S.current,totalChars:d,correctWords:o,incorrectWords:u,totalWords:c.length,timeElapsed:t,maxCombo:M}},[y,M,c.length]),A=e.useCallback(t=>{const s=y[t];if(!s)return[];const o=s.word,u=t===a?l:s.typedValue,n=[];for(let r=0;r<o.length;r++){const p=o[r],d=u[r];d===void 0?n.push({char:p,status:"pending"}):d===p?n.push({char:p,status:"correct",typedChar:d}):n.push({char:p,status:"incorrect",typedChar:d})}for(let r=o.length;r<u.length;r++)n.push({char:u[r],status:"extra",typedChar:u[r]});return n},[y,a,l]),z=e.useCallback(t=>{if(t.key==="Tab"){t.preventDefault();return}if(i==="ready"&&(g.current=Date.now(),m.current=Date.now(),f("playing")),i!=="playing"&&i!=="ready")return;const s=Date.now(),o=w.current?s-w.current:0;w.current=s;const u=c[a];if(!u)return;if(t.key===" "){if(t.preventDefault(),l.length===0)return;B();return}if(t.key==="Backspace"){l.length>0&&k(r=>r.slice(0,-1));return}if(t.key.length>1&&!["Enter"].includes(t.key))return;if(t.key==="Enter"){a===c.length-1&&l.length>0&&B();return}const n=t.key;if(n.length===1){const r=u[l.length],p=n===r;b.current++,p?(C.current++,W(d=>{const D=d+1;return v(h=>Math.max(h,D)),D})):(S.current++,W(0),V?.(a,l.length,r||"",n)),P?.({key:n,timestamp:s,interKeyTime:o,wordIndex:a,charIndex:l.length,isCorrect:p,expected:r||""}),k(d=>d+n)}},[i,a,l,c,V,P]),B=e.useCallback(()=>{const t=c[a],s=l===t,o=m.current?(Date.now()-m.current)/1e3:0,u=o>0?Math.round(t.length/5/(o/60)):0;T(n=>n.map((r,p)=>p===a?{...r,status:"completed",typedValue:l,isCorrect:s,endTime:Date.now()}:p===a+1?{...r,status:"current"}:r)),I?.(a,s,u),a+1>=c.length?(f("completed"),K?.(E)):(x(n=>n+1),k(""),m.current=Date.now())},[a,l,c,E,I,K]),G=e.useCallback(t=>(t.preventDefault(),!1),[]),F=e.useCallback(()=>{const t=c.map((s,o)=>({word:s,index:o,status:o===0?"current":"pending",typedValue:"",isCorrect:!1,characterStates:s.split("").map(u=>({char:u,status:"pending",typedChar:void 0}))}));T(t),x(0),k(""),W(0),v(0),C.current=0,S.current=0,b.current=0,g.current=null,w.current=null,m.current=null,f("ready")},[c]),H=e.useCallback(()=>{i==="ready"&&(g.current=Date.now(),m.current=Date.now(),f("playing"))},[i]),J=e.useCallback(()=>{i==="playing"&&f("paused")},[i]),L=e.useCallback(()=>{i==="paused"&&f("playing")},[i]);return{status:i,wordStates:y,currentWordIndex:a,currentInput:l,stats:E,combo:q,maxCombo:M,words:c,currentWord:c[a]||"",isComplete:i==="completed",progress:c.length>0?a/c.length*100:0,getCharacterStates:A,handleKeyDown:z,handlePaste:G,reset:F,start:H,pause:J,resume:L,inputProps:{value:l,onKeyDown:z,onPaste:G,onChange:()=>{},autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}}}export{O as u};
