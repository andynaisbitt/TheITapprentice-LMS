import{s as g,f as p,r as h,j as f,t as m}from"./index-9AhYSV_Z.js";const w={googleLogin:async t=>(await g.post("/api/v1/auth/oauth/google",t)).data,unlinkGoogle:async()=>(await g.post("/api/v1/auth/oauth/google/unlink")).data};class i extends Error{}i.prototype.name="InvalidTokenError";function v(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,o)=>{let a=o.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}function y(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return v(e)}catch{return atob(e)}}function G(t,e){if(typeof t!="string")throw new i("Invalid token specified: must be a string");e||(e={});const o=e.header===!0?0:1,a=t.split(".")[o];if(typeof a!="string")throw new i(`Invalid token specified: missing part #${o+1}`);let l;try{l=y(a)}catch(n){throw new i(`Invalid token specified: invalid base64 for part #${o+1} (${n.message})`)}try{return JSON.parse(l)}catch(n){throw new i(`Invalid token specified: invalid json for part #${o+1} (${n.message})`)}}const k=({mode:t,onSuccess:e,onError:o})=>{const a=p(),[l,n]=h.useState(!1),d=async c=>{if(!c.credential){o?.("No credential received from Google");return}n(!0);try{const r=G(c.credential);console.log("Google OAuth success:",r);const s=await w.googleLogin({email:r.email,google_id:r.sub,first_name:r.given_name,last_name:r.family_name,avatar_url:r.picture});console.log("Backend OAuth success:",s),e?.(),s.role==="admin"||s.is_admin?a("/admin",{replace:!0}):a("/",{replace:!0})}catch(r){console.error("Google OAuth error:",r);const s=r.response?.data?.detail||"Google sign-in failed. Please try again.";o?.(s)}finally{n(!1)}},u=()=>{console.error("Google OAuth failed"),o?.("Google sign-in failed. Please try again.")};return f.jsx(m,{onSuccess:d,onError:u,useOneTap:!1,theme:"outline",size:"large",width:"100%",text:t==="login"?"signin_with":"signup_with"})};export{k as G};
