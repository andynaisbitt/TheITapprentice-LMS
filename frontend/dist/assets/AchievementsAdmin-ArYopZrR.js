import{c as w,r as c,j as e,w as A,T as u,U as T,n as F,Z as v,h as E,a5 as L,b as P,G as $,a as I,X as U}from"./index-smch1bU1.js";import{L as D}from"./loader-2-D9MIupjh.js";import{S as N}from"./star-BX-qMkwk.js";import{F as M}from"./filter-8mvCWH_v.js";import{P as R}from"./pen-LvGhHwn3.js";import{T as G}from"./trash-2-7shbvHm_.js";import{S as O}from"./sparkles-BWRGzw9b.js";import{G as q}from"./gift-ru-Puqui.js";import{M as z}from"./medal-C-gRj-JI.js";import{C as H}from"./calendar-D0h1sdek.js";import{F as X}from"./flame-CrTy1GJj.js";const B=w("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]),Z=w("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),_={Trophy:u,BookOpen:I,Compass:B,GraduationCap:$,Flame:X,Calendar:H,Target:P,Award:L,Crown:E,Medal:z,Gift:q,Heart:Z,Star:N,Zap:v,Sparkles:O},W=Object.keys(_),V={common:{bg:"bg-gray-100 dark:bg-gray-700",text:"text-gray-600 dark:text-gray-300",border:"border-gray-300"},uncommon:{bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-600 dark:text-green-400",border:"border-green-400"},rare:{bg:"bg-blue-100 dark:bg-blue-900/30",text:"text-blue-600 dark:text-blue-400",border:"border-blue-400"},epic:{bg:"bg-purple-100 dark:bg-purple-900/30",text:"text-purple-600 dark:text-purple-400",border:"border-purple-400"},legendary:{bg:"bg-yellow-100 dark:bg-yellow-900/30",text:"text-yellow-600 dark:text-yellow-400",border:"border-yellow-400"}},j={tutorials:"Tutorials",courses:"Courses",typing:"Typing Games",social:"Social",streak:"Streaks",special:"Special"},ie=()=>{const[l,d]=c.useState([]),[y,o]=c.useState(!0),[s,g]=c.useState(""),[m,h]=c.useState("all"),[p,x]=c.useState(!1),[r,a]=c.useState(null);c.useEffect(()=>{C()},[]);const C=async()=>{o(!0);try{const t=await fetch("/api/v1/progress/admin/achievements",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Failed to fetch achievements");const k=(await t.json()).map(i=>({id:i.id,name:i.name,description:i.description,icon:i.icon||"Trophy",category:i.category||"special",rarity:i.rarity||"common",xp_reward:i.xp_reward||0,unlock_condition:i.unlock_condition||{},is_hidden:i.is_hidden||!1,is_active:i.is_active??!0,unlock_count:i.unlock_count||0}));d(k)}catch(t){console.error("Failed to load achievements:",t),d([])}finally{o(!1)}},S=async t=>{if(confirm("Are you sure you want to delete this achievement?"))try{if(!(await fetch(`/api/v1/progress/admin/achievements/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)throw new Error("Failed to delete achievement");d(l.filter(k=>k.id!==t))}catch(n){console.error("Failed to delete achievement:",n),alert("Failed to delete achievement")}},f=l.filter(t=>!(m!=="all"&&t.category!==m||s&&!t.name.toLowerCase().includes(s.toLowerCase())&&!t.description.toLowerCase().includes(s.toLowerCase()))),b={total:l.length,active:l.filter(t=>t.is_active).length,totalUnlocks:l.reduce((t,n)=>t+(n.unlock_count||0),0)};return y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(D,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Achievements"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage achievement definitions and rewards"})]}),e.jsxs("button",{onClick:()=>{a(null),x(!0)},className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors",children:[e.jsx(A,{className:"w-4 h-4"}),"Add Achievement"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(u,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:b.total}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Achievements"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(N,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:b.active}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Active"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(T,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:b.totalUnlocks}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Unlocks"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search achievements...",value:s,onChange:t=>g(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsxs("select",{value:m,onChange:t=>h(t.target.value),className:"pl-10 pr-8 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 appearance-none",children:[e.jsx("option",{value:"all",children:"All Categories"}),Object.entries(j).map(([t,n])=>e.jsx("option",{value:t,children:n},t))]})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden",children:f.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(u,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No achievements found"})]}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:f.map(t=>{const n=V[t.rarity];return e.jsx("div",{className:`p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors ${t.is_active?"":"opacity-50"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl border-2 ${n.bg} ${n.border}`,children:e.jsx(u,{className:`w-6 h-6 ${n.text}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:t.name}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${n.bg} ${n.text}`,children:t.rarity}),t.is_hidden&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300",children:"Hidden"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-xs text-gray-400",children:[e.jsx("span",{children:j[t.category]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-3 h-3"}),t.xp_reward," XP"]}),e.jsxs("span",{children:[t.unlock_count||0," unlocks"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{a(t),x(!0)},className:"p-2 text-gray-400 hover:text-primary transition-colors",children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S(t.id),className:"p-2 text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(G,{className:"w-4 h-4"})})]})]})},t.id)})})}),p&&e.jsx(J,{achievement:r,onClose:()=>x(!1),onSave:t=>{if(r)d(l.map(n=>n.id===r.id?{...n,...t}:n));else{const n={...t,id:`achievement_${Date.now()}`,unlock_count:0};d([...l,n])}x(!1)}})]})},J=({achievement:l,onClose:d,onSave:y})=>{const[o,s]=c.useState({name:l?.name||"",description:l?.description||"",icon:l?.icon||"Trophy",category:l?.category||"tutorials",rarity:l?.rarity||"common",xp_reward:l?.xp_reward||50,unlock_condition:l?.unlock_condition||{type:"count",action:"",count:1},is_hidden:l?.is_hidden||!1,is_active:l?.is_active??!0}),[g,m]=c.useState(l?.unlock_condition?.type||"count"),h=r=>{switch(m(r),r){case"count":s(a=>({...a,unlock_condition:{type:"count",action:"",count:1}}));break;case"value":s(a=>({...a,unlock_condition:{type:"value",metric:"",operator:">=",value:0}}));break;case"streak":s(a=>({...a,unlock_condition:{type:"streak",days:7}}));break;case"special":s(a=>({...a,unlock_condition:{type:"special",trigger:"manual"}}));break}},p=r=>{r.preventDefault(),y(o)},x=_[o.icon]||u;return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:l?"Edit Achievement":"New Achievement"}),e.jsx("button",{onClick:d,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx(U,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:p,className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Name *"}),e.jsx("input",{type:"text",required:!0,value:o.name,onChange:r=>s(a=>({...a,name:r.target.value})),className:"w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50",placeholder:"First Steps"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description *"}),e.jsx("textarea",{required:!0,rows:2,value:o.description,onChange:r=>s(a=>({...a,description:r.target.value})),className:"w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50",placeholder:"Complete your first tutorial"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Icon"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:o.icon,onChange:r=>s(a=>({...a,icon:r.target.value})),className:"w-full pl-10 pr-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 appearance-none",children:W.map(r=>e.jsx("option",{value:r,children:r},r))}),e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2",children:e.jsx(x,{className:"w-4 h-4 text-gray-500"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Category"}),e.jsx("select",{value:o.category,onChange:r=>s(a=>({...a,category:r.target.value})),className:"w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50",children:Object.entries(j).map(([r,a])=>e.jsx("option",{value:r,children:a},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rarity"}),e.jsxs("select",{value:o.rarity,onChange:r=>s(a=>({...a,rarity:r.target.value})),className:"w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50",children:[e.jsx("option",{value:"common",children:"Common"}),e.jsx("option",{value:"uncommon",children:"Uncommon"}),e.jsx("option",{value:"rare",children:"Rare"}),e.jsx("option",{value:"epic",children:"Epic"}),e.jsx("option",{value:"legendary",children:"Legendary"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"XP Reward"}),e.jsxs("div",{className:"relative",children:[e.jsx(v,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-yellow-500"}),e.jsx("input",{type:"number",min:0,step:25,value:o.xp_reward,onChange:r=>s(a=>({...a,xp_reward:parseInt(r.target.value)||0})),className:"w-full pl-10 pr-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"})]})]}),e.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Unlock Condition"}),e.jsx("div",{className:"flex gap-2",children:["count","value","streak","special"].map(r=>e.jsx("button",{type:"button",onClick:()=>h(r),className:`px-3 py-1 text-sm rounded-lg transition-colors ${g===r?"bg-primary text-white":"bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-500"}`,children:r.charAt(0).toUpperCase()+r.slice(1)},r))}),g==="count"&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Action"}),e.jsxs("select",{value:o.unlock_condition.action||"",onChange:r=>s(a=>({...a,unlock_condition:{...a.unlock_condition,action:r.target.value}})),className:"w-full px-3 py-2 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg",children:[e.jsx("option",{value:"",children:"Select action..."}),e.jsx("option",{value:"tutorial_complete",children:"Complete Tutorial"}),e.jsx("option",{value:"course_complete",children:"Complete Course"}),e.jsx("option",{value:"typing_game_play",children:"Play Typing Game"}),e.jsx("option",{value:"typing_game_win",children:"Win Typing Game"}),e.jsx("option",{value:"comment_post",children:"Post Comment"}),e.jsx("option",{value:"profile_update",children:"Update Profile"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Count Required"}),e.jsx("input",{type:"number",min:1,value:o.unlock_condition.count||1,onChange:r=>s(a=>({...a,unlock_condition:{...a.unlock_condition,count:parseInt(r.target.value)||1}})),className:"w-full px-3 py-2 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg"})]})]}),g==="value"&&e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Metric"}),e.jsxs("select",{value:o.unlock_condition.metric||"",onChange:r=>s(a=>({...a,unlock_condition:{...a.unlock_condition,metric:r.target.value}})),className:"w-full px-3 py-2 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg",children:[e.jsx("option",{value:"",children:"Select metric..."}),e.jsx("option",{value:"wpm",children:"WPM (Typing Speed)"}),e.jsx("option",{value:"accuracy",children:"Accuracy (%)"}),e.jsx("option",{value:"xp_total",children:"Total XP"}),e.jsx("option",{value:"level",children:"User Level"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Operator"}),e.jsxs("select",{value:o.unlock_condition.operator||">=",onChange:r=>s(a=>({...a,unlock_condition:{...a.unlock_condition,operator:r.target.value}})),className:"w-full px-3 py-2 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg",children:[e.jsx("option",{value:">=",children:"≥ (at least)"}),e.jsx("option",{value:">",children:" (more than)"}),e.jsx("option",{value:"=",children:"=  (exactly)"}),e.jsx("option",{value:"<=",children:"≤ (at most)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Value"}),e.jsx("input",{type:"number",min:0,value:o.unlock_condition.value||0,onChange:r=>s(a=>({...a,unlock_condition:{...a.unlock_condition,value:parseInt(r.target.value)||0}})),className:"w-full px-3 py-2 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg"})]})]}),g==="streak"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Days Required"}),e.jsx("input",{type:"number",min:1,value:o.unlock_condition.days||7,onChange:r=>s(a=>({...a,unlock_condition:{type:"streak",days:parseInt(r.target.value)||7}})),className:"w-full px-3 py-2 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg"})]}),g==="special"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Trigger Type"}),e.jsxs("select",{value:o.unlock_condition.trigger||"manual",onChange:r=>s(a=>({...a,unlock_condition:{type:"special",trigger:r.target.value}})),className:"w-full px-3 py-2 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg",children:[e.jsx("option",{value:"manual",children:"Manual Award"}),e.jsx("option",{value:"registration_date",children:"Registration Date"}),e.jsx("option",{value:"event",children:"Special Event"}),e.jsx("option",{value:"referral",children:"Referral Program"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Special achievements are awarded manually or through specific events."})]})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.is_active,onChange:r=>s(a=>({...a,is_active:r.target.checked})),className:"w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Active"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.is_hidden,onChange:r=>s(a=>({...a,is_hidden:r.target.checked})),className:"w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Hidden (Secret Achievement)"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:p,className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors",children:l?"Save Changes":"Create Achievement"})]})]})})};export{ie as AchievementsAdmin,ie as default};
