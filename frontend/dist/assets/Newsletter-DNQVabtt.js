import{f as T,r as d,g as u,j as e,A as S,m as y,n as M,X as F}from"./index-smch1bU1.js";const z=()=>{const p=T(),[s,o]=d.useState([]),[C,j]=d.useState(!0),[k,l]=d.useState(null),[f,c]=d.useState(null),[A,m]=d.useState(!1),[a,g]=d.useState({subject:"",body:""}),[b,v]=d.useState(!1),[n,N]=d.useState("");d.useEffect(()=>{w()},[]);const w=async()=>{try{j(!0),l(null);const r=(await u.get("/api/v1/admin/newsletter/subscribers")).data;Array.isArray(r)?o(r):r&&Array.isArray(r.subscribers)?o(r.subscribers):(console.error("Unexpected data format:",r),o([]))}catch(t){console.error("Error fetching subscribers:",t),l(t.response?.data?.detail||"Failed to load subscribers. Please try again."),o([])}finally{j(!1)}},E=async(t,r)=>{if(confirm(`Remove ${r}?`))try{await u.delete(`/api/v1/admin/newsletter/subscribers/${t}`),o(s.filter(x=>x.id!==t)),c(`${r} removed`),setTimeout(()=>c(null),3e3)}catch(x){console.error("Error removing subscriber:",x),l(x.response?.data?.detail||"Failed to remove subscriber"),setTimeout(()=>l(null),3e3)}},L=async()=>{if(!a.subject.trim()||!a.body.trim()){l("Please fill in both subject and body");return}try{v(!0),l(null);const t=await u.post("/api/v1/admin/newsletter/send-to-all",{subject:a.subject,body:a.body});c(`Sent to ${t.data.sent} subscribers!`),m(!1),g({subject:"",body:""}),setTimeout(()=>c(null),5e3)}catch(t){console.error("Error sending newsletter:",t),l(t.response?.data?.detail||"Failed to send. Check SMTP settings.")}finally{v(!1)}},h=d.useMemo(()=>{if(!n.trim())return s;const t=n.toLowerCase();return s.filter(r=>r.email.toLowerCase().includes(t))},[s,n]),i=Array.isArray(s)?s.filter(t=>t.is_active):[];return C&&s.length===0?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-slate-900 py-3 sm:py-6",children:[e.jsxs("div",{className:"max-w-6xl mx-auto px-3 sm:px-6",children:[e.jsxs("div",{className:"mb-3 sm:mb-6",children:[e.jsx("h1",{className:"text-xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:"Newsletter"}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:[s.length," subscriber",s.length!==1?"s":""]})]}),e.jsxs(S,{children:[k&&e.jsx(y.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-2 sm:p-3",children:e.jsxs("p",{className:"text-xs sm:text-sm text-red-800 dark:text-red-300",children:["âš ï¸ ",k]})}),f&&e.jsx(y.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-2 sm:p-3",children:e.jsxs("p",{className:"text-xs sm:text-sm text-green-800 dark:text-green-300",children:["âœ“ ",f]})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-gray-200 dark:border-slate-700 p-2 sm:p-3 mb-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3 mb-3",children:[e.jsxs("div",{className:"text-center py-1",children:[e.jsx("p",{className:"text-lg sm:text-2xl font-bold text-gray-900 dark:text-gray-100",children:s.length}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-400",children:"Total"})]}),e.jsxs("div",{className:"text-center py-1 border-l border-r border-gray-200 dark:border-slate-600",children:[e.jsx("p",{className:"text-lg sm:text-2xl font-bold text-green-600 dark:text-green-400",children:i.length}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-400",children:"Active"})]}),e.jsxs("div",{className:"text-center py-1",children:[e.jsx("p",{className:"text-lg sm:text-2xl font-bold text-gray-500 dark:text-gray-400",children:s.length-i.length}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-400",children:"Inactive"})]})]}),e.jsxs("div",{className:"flex gap-1.5 sm:gap-2",children:[e.jsxs("button",{onClick:()=>m(!0),disabled:i.length===0,className:"flex-1 px-2 sm:px-3 py-1.5 sm:py-2 bg-blue-600 dark:bg-blue-700 text-white rounded-md hover:bg-blue-700 dark:hover:bg-blue-600 transition font-medium disabled:opacity-50 disabled:cursor-not-allowed text-xs sm:text-sm",children:[e.jsx("span",{className:"hidden xs:inline",children:"ðŸ“§ "}),"Send"]}),e.jsx("button",{onClick:w,className:"px-2 sm:px-3 py-1.5 sm:py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-slate-600 rounded-md hover:bg-gray-100 dark:hover:bg-slate-700 transition text-xs sm:text-sm",title:"Refresh",children:"ðŸ”„"}),e.jsx("button",{onClick:()=>p("/admin/settings"),className:"px-2 sm:px-3 py-1.5 sm:py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-slate-600 rounded-md hover:bg-gray-100 dark:hover:bg-slate-700 transition text-xs sm:text-sm",title:"Settings",children:"âš™ï¸"})]})]}),e.jsxs("div",{className:"sticky top-0 z-10 bg-gray-50 dark:bg-slate-900 pb-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",value:n,onChange:t=>N(t.target.value),placeholder:"Search subscribers...",className:"w-full pl-9 pr-9 py-2 sm:py-2.5 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-lg text-sm text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),n&&e.jsx("button",{onClick:()=>N(""),className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:bg-gray-200 dark:hover:bg-slate-700 rounded",children:e.jsx(F,{size:14,className:"text-gray-400"})})]}),n&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1.5",children:[h.length," of ",s.length," shown"]})]}),e.jsx("div",{className:"space-y-1.5 sm:space-y-2",children:h.length===0?e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-gray-200 dark:border-slate-700 p-8 sm:p-12 text-center",children:e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n?"No subscribers found":"No subscribers yet"})}):h.map(t=>e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-md shadow-sm border border-gray-200 dark:border-slate-700 p-2 sm:p-3 hover:shadow transition",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:t.email}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`inline-flex px-1.5 py-0.5 text-[10px] sm:text-xs font-medium rounded ${t.is_active?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-300"}`,children:t.is_active?"Active":"Inactive"}),e.jsx("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400",children:new Date(t.subscribed_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"})})]})]}),e.jsx("button",{onClick:()=>E(t.id,t.email),className:"flex-shrink-0 px-2 sm:px-3 py-1 sm:py-1.5 text-[10px] sm:text-xs font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition",children:"Remove"})]})},t.id))}),e.jsx("div",{className:"mt-4 sm:mt-6",children:e.jsx("button",{onClick:()=>p("/admin"),className:"px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-slate-600 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition",children:"â† Back"})})]}),e.jsx(S,{children:A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-3 sm:p-4 z-50",children:e.jsxs(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-gray-200 dark:border-slate-700 max-w-2xl w-full p-4 sm:p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2 sm:mb-4",children:"Send Newsletter"}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-4 sm:mb-6",children:["Send to ",i.length," active subscriber",i.length!==1?"s":""]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4 mb-4 sm:mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5 sm:mb-2",children:"Subject"}),e.jsx("input",{type:"text",value:a.subject,onChange:t=>g({...a,subject:t.target.value}),placeholder:"Newsletter subject...",className:"w-full px-3 sm:px-4 py-2 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg text-sm sm:text-base text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5 sm:mb-2",children:["Body ",e.jsx("span",{className:"text-gray-500",children:"(HTML supported)"})]}),e.jsx("textarea",{value:a.body,onChange:t=>g({...a,body:t.target.value}),rows:8,placeholder:"Newsletter content... (HTML is supported)",className:"w-full px-3 sm:px-4 py-2 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-lg text-sm text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono"})]})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>m(!1),disabled:b,className:"flex-1 px-3 sm:px-4 py-2 text-sm sm:text-base text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-slate-600 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition",children:"Cancel"}),e.jsx("button",{onClick:L,disabled:b||!a.subject.trim()||!a.body.trim(),className:"flex-1 px-3 sm:px-4 py-2 text-sm sm:text-base bg-blue-600 dark:bg-blue-700 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Sending..."]}):e.jsxs(e.Fragment,{children:["ðŸ“§ ",e.jsx("span",{className:"hidden xs:inline",children:"Send to"})," ",i.length]})})]})]})})})]})};export{z as Newsletter,z as default};
