import{c as pe,u as Se,r as a,j as e,M as _e,m as r,b as U,A as Me,Z as de,e as Ge,f as Re}from"./index-CH_EXTVi.js";import{t as V}from"./typingGameApi-DeLeUFq8.js";import{u as Ae}from"./useTypingEngine-B036qq_F.js";import{u as Pe,a as Te,b as We,S as De,C as $e,W as Be}from"./SoundSettings-N1pn3PZL.js";import{S as Ee}from"./StreakDisplay-DE_-Qy0m.js";import{R as ce}from"./RegistrationPrompt-CIgB8nS2.js";import{u as Le}from"./useRegistrationPrompt-BS_vcVyy.js";import{G as p}from"./ghost-pIin0xm0.js";import{P as Ie}from"./play-BHEkGL37.js";import{A as Fe}from"./arrow-left-CTJyzdxq.js";import{S as q}from"./star-BISlQTdL.js";import{R as me}from"./rotate-ccw-BzvJj0pt.js";import{S as Ke}from"./sparkles-xvle3ljW.js";import{M as Ye}from"./minus-C-pooiIT.js";import"./flame-Dm-WfBw5.js";import"./log-in-Dm5UP0qO.js";const ze=pe("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),Oe=pe("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),A=[{roundNumber:1,name:"Warmup",timeLimit:null,description:"Get into the groove. Your ghost is watching!"},{roundNumber:2,name:"Speed Challenge",timeLimit:25,description:"Beat your ghost in 25 seconds!"},{roundNumber:3,name:"INSANE MODE",timeLimit:12,description:"Final showdown - 12 seconds!"}],xe={1:["The quick brown fox jumps over the lazy dog","Pack my box with five dozen liquor jugs","How vexingly quick daft zebras jump","User reports Outlook stuck on loading profile","Rebooted the server and cleared the DNS cache","Check the firewall rules and open port 443","The backup completed successfully at midnight"],2:["function deploy(env) { return fetch(api + env); }",'git commit -m "fix: resolve login timeout issue"',"docker run -d -p 8080:80 nginx:latest","npm install express cors dotenv jsonwebtoken","ssh admin@192.168.1.100 -i ~/.ssh/id_rsa"],3:["Quick wafting zephyrs vex bold Jim","Sphinx of black quartz judge my vow","sudo rm -rf /tmp/cache && reboot now","ping 8.8.8.8 && traceroute google.com","git push origin main --force-with-lease"]},He=({currentWpm:u,ghostWpm:d,className:m=""})=>{const c=u-d,j=c>0,w=c<0,_=c===0;return e.jsxs(r.div,{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${j?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":w?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-400"} ${m}`,animate:j?{scale:[1,1.05,1]}:w?{x:[-2,2,-2,2,0]}:{},transition:{duration:.3},children:[e.jsx(p,{className:"w-5 h-5 opacity-70"}),j&&e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-bold",children:["+",c," WPM"]})]}),w&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-bold",children:[c," WPM"]})]}),_&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx("span",{className:"font-bold",children:"Tied!"})]})]})},Ue=({currentProgress:u,ghostProgress:d})=>e.jsxs("div",{className:"relative h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:[e.jsx(r.div,{className:"absolute top-0 left-0 h-full bg-purple-400/40 dark:bg-purple-500/40 rounded-full",initial:{width:"0%"},animate:{width:`${d}%`},transition:{duration:.3}}),e.jsx(r.div,{className:`absolute top-0 left-0 h-full rounded-full ${u>=d?"bg-green-500":"bg-blue-500"}`,initial:{width:"0%"},animate:{width:`${u}%`},transition:{duration:.3}}),e.jsx(r.div,{className:"absolute top-0 h-full w-1 bg-purple-600 dark:bg-purple-400 shadow-lg",style:{left:`calc(${d}% - 2px)`},children:e.jsx(p,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 absolute -top-5 -left-1.5"})})]}),Ve=({onComplete:u,seconds:d,roundColor:m})=>{const[c,j]=a.useState(d);return a.useEffect(()=>{if(c<=0){u();return}const w=setTimeout(()=>j(_=>_-1),1e3);return()=>clearTimeout(w)},[c,u]),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(r.div,{initial:{scale:1.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},transition:{duration:.3,type:"spring",damping:15},className:`text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r ${m}`,children:c},c),e.jsx("div",{className:"relative w-16 h-1 mt-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx(r.div,{className:`absolute inset-y-0 left-0 bg-gradient-to-r ${m} rounded-full`,initial:{width:"100%"},animate:{width:"0%"},transition:{duration:d,ease:"linear"}})})]})},qe=({onComplete:u,onExit:d})=>{const{isAuthenticated:m}=Se(),{isPromptOpen:c,closePrompt:j,handleSkip:w,showPrompt:_}=Le({context:"game",onSkip:()=>{}}),g=Pe(),[n,ue]=a.useState(null),[X,Z]=a.useState(!0),[x,k]=a.useState("idle"),[l,J]=a.useState(0),[Q,ee]=a.useState(""),[L,ge]=a.useState(null),[M,he]=a.useState(null),[y,te]=a.useState([]),[P,W]=a.useState(null),[se,be]=a.useState(""),[ye,I]=a.useState(!1),[ae,re]=a.useState(""),[ne,Xe]=a.useState(null),D=a.useRef(null),G=a.useRef(null),C=a.useRef(null),F=a.useRef(!1),T=A[l],$=a.useCallback(t=>{const s=xe[t]||xe[1];return s[Math.floor(Math.random()*s.length)]},[]),K=a.useRef("none"),{wordStates:S,currentWordIndex:B,currentInput:Y,stats:N,maxCombo:E,getCharacterStates:fe,handleKeyDown:le,handlePaste:je,reset:oe}=Ae(Q,{onWordComplete:(t,s,o)=>{const i=S[t];i&&re(b=>b+(b?" ":"")+i.typedValue),s&&g.playMilestone()},onGameComplete:()=>{g.playGameEnd(),O(!0)},onError:()=>{g.playError(),h.breakCombo(),f.recordKeystroke()},onKeystroke:t=>{f.recordKeystroke(t.timestamp),t.isCorrect&&(h.increment(),g.playKeystroke());const s=h.tier;s!==K.current&&s!=="none"&&(g.playCombo(h.combo),K.current=s)}}),f=Te({enabled:!0,onSuspiciousActivity:t=>{console.log("[Anti-Cheat] Suspicious activity:",t)}}),h=We({onComboMilestone:(t,s)=>{console.log(`[Combo] Milestone: ${t} (${s})`)},onComboBreak:(t,s)=>{console.log(`[Combo] Broken at ${t}, max was ${s}`)},onTierUp:(t,s)=>{console.log(`[Combo] Tier up to ${t} at ${s}`)}}),R=a.useCallback(()=>{D.current&&setTimeout(()=>{D.current?.focus(),D.current?.scrollIntoView({behavior:"smooth",block:"center"})},100)},[]),we=a.useMemo(()=>{if(!n||!C.current||x!=="playing"||(Date.now()-C.current)/1e3/60<=0)return 0;const s=n.best_wpm/60*(Date.now()-C.current)/1e3,o=S.length;return Math.min(100,s/o*100)},[n,S.length,x,N.timeElapsed]),Ne=a.useMemo(()=>S.length===0?0:B/S.length*100,[B,S.length]);a.useEffect(()=>{(async()=>{if(!m){Z(!1);return}try{const s=await V.getMyStats();s.total_games_completed>0&&s.best_wpm>0&&ue(s)}catch(s){console.error("Failed to load ghost stats:",s)}finally{Z(!1)}})()},[m]);const z=a.useCallback(async()=>{if(!n){k("no_ghost");return}try{const s=await V.startGame({mode:"challenge",word_count:9});ge(s),be(s.checksum)}catch(s){console.error("Failed to start game session:",s)}J(0),te([]);const t=$(1);ee(t),k("ready")},[n,$]),ie=a.useCallback(()=>{oe(),h.reset(),f.reset(),f.startTracking(),K.current="none",re(""),C.current=Date.now();const t=A[l];t.timeLimit?W(t.timeLimit):W(null),g.playGameStart(),k("playing"),R()},[l,oe,h,f,R,g]),O=a.useCallback(t=>{G.current&&(clearInterval(G.current),G.current=null),f.stopTracking();const s=C.current?(Date.now()-C.current)/1e3:0,o=n?N.wpm>n.best_wpm:!1,i={round:l+1,wpm:N.wpm,accuracy:N.accuracy,time:Math.round(s*10)/10,passed:t,maxCombo:Math.max(E,h.maxCombo),beatGhost:o};te(b=>[...b,i]),t?l>=A.length-1?ve():k("round_complete"):k("failed")},[l,N,E,h.maxCombo,f,n]),ve=a.useCallback(async()=>{if(!L){k("game_complete");return}const t=f.getAntiCheatData(),s={session_id:L.session_id,user_input:ae,time_elapsed:Math.round(N.timeElapsed),checksum:se,max_combo:Math.max(E,h.maxCombo),anti_cheat:{keystroke_timings:t.keystrokeTimings,keystroke_count:t.keystrokeCount,paste_attempts:t.pasteAttempts,focus_lost_count:t.focusLostCount,total_focus_lost_time:t.totalFocusLostTime,first_segment_avg:t.firstSegmentAvg,last_segment_avg:t.lastSegmentAvg}};try{const o=await V.submitGameV2(s);(o.is_personal_best_wpm||o.is_personal_best_accuracy)&&g.playPersonalBest(),he(o),k("game_complete"),u?.(o)}catch(o){console.error("Failed to submit results:",o),k("game_complete")}},[L,ae,N.timeElapsed,se,E,h.maxCombo,f,u,g]),ke=a.useCallback(()=>{const t=l+1;J(t);const s=$(t+1);ee(s),k("ready")},[l,$]);a.useEffect(()=>{if(x==="playing"&&T?.timeLimit)return G.current=setInterval(()=>{const t=C.current?(Date.now()-C.current)/1e3:0,s=T.timeLimit-t;s<=0?(W(0),O(!1)):W(Math.ceil(s))},100),()=>{G.current&&clearInterval(G.current)}},[x,T,O]),a.useEffect(()=>{x==="playing"&&(I(!0),R())},[x,R]);const H=a.useCallback((t,s=!1)=>{if((t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="v"){t.preventDefault(),f.recordPasteAttempt();return}s||(F.current=!0),le(t)},[le,f]),v=a.useMemo(()=>y.length===0?{wpm:0,accuracy:0,maxCombo:0,roundsBeatGhost:0}:{wpm:Math.round(y.reduce((t,s)=>t+s.wpm,0)/y.length),accuracy:Math.round(y.reduce((t,s)=>t+s.accuracy,0)/y.length),maxCombo:Math.max(...y.map(t=>t.maxCombo)),roundsBeatGhost:y.filter(t=>t.beatGhost).length},[y]);if(X)return e.jsx("div",{className:"max-w-2xl mx-auto p-4 sm:p-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 text-center",children:[e.jsx(p,{className:"w-16 h-16 text-purple-500 mx-auto mb-4 animate-pulse"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading your ghost..."})]})});if(x==="no_ghost"||!X&&!n&&!m)return e.jsx("div",{className:"max-w-2xl mx-auto p-4 sm:p-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 text-center",children:[e.jsx(p,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900 dark:text-white",children:"No Ghost Yet"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:m?"Complete at least one typing challenge to create your ghost!":"Sign in and complete a challenge to race against your personal best."}),!m&&e.jsxs("button",{onClick:_,className:"px-6 py-3 bg-purple-500 text-white rounded-lg font-semibold hover:bg-purple-600 transition-all flex items-center gap-2 mx-auto",children:[e.jsx(_e,{className:"w-5 h-5"}),"Sign In"]}),d&&e.jsx("button",{onClick:d,className:"mt-4 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:"← Back to Typing Games"})]})});if(x==="idle")return e.jsx("div",{className:"max-w-4xl mx-auto p-4 sm:p-6",children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"md:col-span-2 bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 sm:p-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center",children:e.jsx(p,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-2 text-gray-900 dark:text-white",children:"Ghost Mode"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Race against your personal best. Can you beat your ghost?"})]}),n&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-xl p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(p,{className:"w-6 h-6 text-purple-500"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"Your Ghost's Best"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:n.best_wpm}),e.jsx("div",{className:"text-xs text-gray-500",children:"WPM"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:[(n.best_accuracy??0).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Accuracy"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:n.total_games_completed}),e.jsx("div",{className:"text-xs text-gray-500",children:"Games"})]})]})]}),e.jsx("div",{className:"space-y-3 mb-6",children:A.map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`
                      w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm
                      ${s===0?"bg-green-500":s===1?"bg-yellow-500":"bg-red-500"}
                    `,children:t.roundNumber}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.name})]}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.timeLimit?`${t.timeLimit}s limit`:"No limit"})]},s))}),e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:z,className:"px-8 py-3 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-lg font-semibold text-lg hover:from-purple-600 hover:to-indigo-700 transition-all flex items-center gap-2 mx-auto",children:[e.jsx(Ie,{className:"w-5 h-5"}),"Challenge Ghost"]})})]}),e.jsxs(r.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.1},className:"space-y-4",children:[ne&&e.jsx(Ee,{streak:ne}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-indigo-50 dark:from-gray-800 dark:to-gray-900 rounded-xl p-4 border border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{className:"w-5 h-5 text-purple-500"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"How it works"})]}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("li",{children:"• Your ghost types at your best WPM"}),e.jsx("li",{children:"• Watch the progress bar to stay ahead"}),e.jsx("li",{children:"• Beat your ghost to set a new record"})]})]})]})]})});if(x==="ready")return e.jsx("div",{className:"max-w-3xl mx-auto p-2 sm:p-4 md:p-6",children:e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 sm:p-8 text-center",children:[e.jsxs(r.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",damping:10},className:`
              inline-flex items-center gap-2 px-4 py-2 rounded-full mb-4 text-white font-bold text-lg
              bg-gradient-to-r
              ${l===0?"from-green-500 to-emerald-600":l===1?"from-yellow-500 to-orange-600":"from-red-500 to-rose-600"}
            `,children:[e.jsx(p,{className:"w-5 h-5"}),"Round ",l+1,": ",T.name]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-3 text-sm",children:T.description}),n&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3 mb-4 inline-flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4 text-purple-500"}),e.jsxs("span",{className:"text-sm text-purple-700 dark:text-purple-300",children:["Ghost target: ",e.jsxs("strong",{children:[n.best_wpm," WPM"]})]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-3 mb-5",children:e.jsx("p",{className:"font-mono text-base sm:text-lg text-gray-600 dark:text-gray-400 line-clamp-2",children:Q})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Ve,{onComplete:ie,seconds:3,roundColor:l===0?"from-green-500 to-emerald-600":l===1?"from-yellow-500 to-orange-600":"from-red-500 to-rose-600"}),e.jsx("button",{onClick:ie,className:"px-6 py-2 text-sm bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Start Now →"})]})]})});if(x==="playing")return e.jsx("div",{className:"max-w-3xl mx-auto p-2 sm:p-4 md:p-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-3 sm:p-4 md:p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsx("button",{onClick:d,className:"p-1.5 sm:p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(Fe,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"text-sm sm:text-base md:text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4 text-purple-500"}),"Round ",l+1]})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"hidden xs:block",children:e.jsx(De,{settings:g.settings,onToggleSound:g.toggleSound,onVolumeChange:g.setVolume,compact:!0})}),P!==null&&e.jsxs(r.div,{className:`text-lg sm:text-xl md:text-2xl font-bold tabular-nums ${P<=5?"text-red-500":"text-purple-500"}`,animate:P<=5?{scale:[1,1.1,1]}:{},transition:{duration:.5,repeat:P<=5?1/0:0},children:[P,"s"]})]})]}),n&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(He,{currentWpm:N.wpm,ghostWpm:n.best_wpm}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Ghost: ",n.best_wpm," WPM"]})]}),e.jsx(Ue,{currentProgress:Ne,ghostProgress:we})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-1.5 sm:gap-2 md:gap-4 mb-3 sm:mb-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 rounded-lg p-1.5 sm:p-2 md:p-3 text-center",children:[e.jsx("div",{className:"text-base sm:text-lg md:text-2xl font-bold text-blue-600 dark:text-blue-400 tabular-nums",children:N.wpm}),e.jsx("div",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-400",children:"WPM"})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/30 rounded-lg p-1.5 sm:p-2 md:p-3 text-center",children:[e.jsxs("div",{className:"text-base sm:text-lg md:text-2xl font-bold text-green-600 dark:text-green-400 tabular-nums",children:[N.accuracy,"%"]}),e.jsx("div",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-400",children:"Acc"})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/30 rounded-lg p-1.5 sm:p-2 md:p-3 text-center",children:[e.jsxs("div",{className:"text-base sm:text-lg md:text-2xl font-bold text-purple-600 dark:text-purple-400 tabular-nums",children:[B,"/",S.length]}),e.jsx("div",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-400",children:"Words"})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/30 rounded-lg p-1.5 sm:p-2 md:p-3 text-center",children:[e.jsx($e,{comboState:h.state,showMaxCombo:!1,size:"sm"}),!h.state.isActive&&e.jsx("div",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-400",children:"Combo"})]})]}),e.jsxs("div",{className:"relative",children:[!ye&&e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 z-10 flex items-center justify-center bg-gray-900/40 dark:bg-gray-900/60 backdrop-blur-[2px] rounded-xl cursor-pointer",onClick:R,children:e.jsx("div",{className:"text-white text-lg font-medium bg-gray-900/80 px-6 py-3 rounded-lg",children:"Click here to continue typing"})}),e.jsx(Be,{words:S,currentWordIndex:B,currentInput:Y,getCharacterStates:fe,onContainerClick:R,className:"mb-2 sm:mb-3 md:mb-4"}),e.jsx("input",{ref:D,type:"text",inputMode:"text",enterKeyHint:"next",value:Y,onKeyDown:H,onPaste:je,onChange:t=>{if(F.current){F.current=!1;return}const s=t.target.value,o=Y;if(s.length>o.length){const i=s.slice(o.length);for(const b of i)H({key:b,preventDefault:()=>{}},!0)}else s.length<o.length&&H({key:"Backspace",preventDefault:()=>{}},!0)},onFocus:()=>I(!0),onBlur:()=>I(!1),className:"absolute top-0 left-0 w-full h-full opacity-0 cursor-default",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,"aria-label":"Type the words shown above"})]}),e.jsxs("p",{className:"text-center text-xs text-gray-500 dark:text-gray-400 mt-1",children:[e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-[10px] sm:text-xs",children:"Space"}),e.jsx("span",{className:"hidden sm:inline",children:" to move to next word"})]})]})});if(x==="round_complete"){const t=y[y.length-1],s=l>=A.length-1;return e.jsx("div",{className:"max-w-3xl mx-auto p-2 sm:p-4 md:p-6",children:e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:`bg-gradient-to-r ${t?.beatGhost?"from-green-500 to-emerald-600":"from-purple-500 to-indigo-600"} p-4 text-white`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t?.beatGhost?e.jsx(q,{className:"w-6 h-6"}):e.jsx(p,{className:"w-6 h-6"}),e.jsx("span",{className:"font-bold text-lg",children:t?.beatGhost?"You beat your ghost!":"Ghost wins this round"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-white/90",children:[e.jsxs("span",{className:"font-bold",children:[t?.wpm||0," WPM"]}),e.jsxs("span",{className:"font-bold",children:[t?.accuracy||0,"%"]})]})]})}),!s&&e.jsxs("div",{className:"p-5 text-center",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:["Next: ",A[l+1]?.name]}),e.jsx("button",{onClick:ke,className:"px-6 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-colors",children:"Continue →"})]})]})})}if(x==="failed")return e.jsx("div",{className:"max-w-2xl mx-auto p-4 sm:p-6",children:e.jsxs(r.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 sm:p-8 text-center",children:[e.jsx(p,{className:"w-16 h-16 text-purple-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900 dark:text-white",children:"Ghost Wins!"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["You didn't complete Round ",l+1," in time."]}),e.jsxs("button",{onClick:z,className:"px-6 py-3 bg-purple-500 text-white rounded-lg font-semibold hover:bg-purple-600 transition-all flex items-center gap-2 mx-auto",children:[e.jsx(me,{className:"w-5 h-5"}),"Try Again"]})]})});if(x==="game_complete"){const t=n?v.wpm>n.best_wpm:!1,s=M?.is_personal_best_wpm||M?.is_personal_best_accuracy,o=t||s;return e.jsxs("div",{className:"max-w-3xl mx-auto p-4 sm:p-6 relative",children:[e.jsx(Me,{children:o&&e.jsx("div",{className:"fixed inset-0 pointer-events-none z-50 overflow-hidden",children:[...Array(50)].map((i,b)=>e.jsx(r.div,{initial:{opacity:1,y:-20,x:Math.random()*(typeof window<"u"?window.innerWidth:1e3),rotate:0},animate:{opacity:0,y:(typeof window<"u"?window.innerHeight:800)+100,rotate:Math.random()*720-360},exit:{opacity:0},transition:{duration:2+Math.random()*2,delay:Math.random()*.5,ease:"easeOut"},className:`absolute w-3 h-3 ${["bg-purple-400","bg-indigo-500","bg-violet-500","bg-pink-500","bg-yellow-400"][Math.floor(Math.random()*5)]} ${Math.random()>.5?"rounded-full":"rounded-sm"}`},b))})}),e.jsxs(r.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 sm:p-8 text-center",children:[t?e.jsxs(e.Fragment,{children:[e.jsxs(r.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",damping:10},className:"relative inline-block",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(r.div,{animate:{scale:[1,1.2,1],opacity:[.5,.8,.5]},transition:{duration:2,repeat:1/0},className:"w-24 h-24 bg-purple-400/30 rounded-full blur-xl"})}),e.jsx(q,{className:"w-20 h-20 text-yellow-500 relative",fill:"currentColor"}),e.jsx(Ke,{className:"w-8 h-8 text-yellow-400 absolute -top-2 -right-2"})]}),e.jsx("h2",{className:"text-3xl font-bold mb-2 text-gray-900 dark:text-white mt-4",children:"You Beat Your Ghost!"})]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-20 h-20 text-purple-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-3xl font-bold mb-2 text-gray-900 dark:text-white",children:"Challenge Complete"})]}),e.jsx(r.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.15,type:"spring",damping:12},className:"mb-2",children:(()=>{const i=v.wpm>=80?"S":v.wpm>=60?"A":v.wpm>=45?"B":v.wpm>=30?"C":"D",b={S:"from-yellow-400 via-amber-500 to-orange-500",A:"from-green-400 to-emerald-500",B:"from-blue-400 to-cyan-500",C:"from-gray-400 to-gray-500",D:"from-red-400 to-red-500"},Ce={S:"Ghost Slayer!",A:"Spirit Hunter!",B:"Ghost Chaser!",C:"Keep Haunting!",D:"Ghost Apprentice"};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`inline-block text-5xl font-black bg-gradient-to-br ${b[i]} bg-clip-text text-transparent`,children:i}),e.jsx("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:Ce[i]})]})})()}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:t?`New personal best! You beat ${n?.best_wpm} WPM!`:`Your ghost (${n?.best_wpm} WPM) is still the champion.`}),s&&e.jsxs(r.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex flex-wrap justify-center gap-2 mb-4",children:[M?.is_personal_best_wpm&&e.jsxs("span",{className:"inline-flex items-center gap-1 bg-gradient-to-r from-purple-400 to-indigo-500 text-white px-3 py-1 rounded-full text-sm font-medium shadow-lg",children:[e.jsx(de,{className:"w-4 h-4"}),"Best WPM"]}),M?.is_personal_best_accuracy&&e.jsxs("span",{className:"inline-flex items-center gap-1 bg-gradient-to-r from-green-400 to-emerald-500 text-white px-3 py-1 rounded-full text-sm font-medium shadow-lg",children:[e.jsx(U,{className:"w-4 h-4"}),"Best Accuracy"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 my-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4",children:[e.jsx(Ge,{className:"w-6 h-6 text-blue-500 mx-auto mb-2"}),e.jsx("div",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:v.wpm}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Avg WPM"})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/30 rounded-lg p-4",children:[e.jsx(U,{className:"w-6 h-6 text-green-500 mx-auto mb-2"}),e.jsxs("div",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:[v.accuracy,"%"]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Accuracy"})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/30 rounded-lg p-4",children:[e.jsx(p,{className:"w-6 h-6 text-purple-500 mx-auto mb-2"}),e.jsxs("div",{className:"text-3xl font-bold text-purple-600 dark:text-purple-400",children:[v.roundsBeatGhost,"/3"]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Rounds Won"})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/30 rounded-lg p-4",children:[e.jsx(de,{className:"w-6 h-6 text-orange-500 mx-auto mb-2"}),e.jsxs("div",{className:"text-3xl font-bold text-orange-600 dark:text-orange-400",children:[v.maxCombo,"x"]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Max Combo"})]})]}),M&&m&&e.jsxs(r.div,{initial:{scale:0,y:-30},animate:{scale:1,y:0},transition:{delay:.4,type:"spring",damping:8},className:"bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/30 dark:to-indigo-900/30 border border-purple-200 dark:border-purple-700 rounded-xl p-5 mb-6 relative overflow-hidden",children:[e.jsx(r.div,{animate:{opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0},className:"absolute inset-0 bg-gradient-to-r from-purple-400/10 via-indigo-400/20 to-purple-400/10"}),e.jsxs("div",{className:"relative",children:[e.jsxs(r.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.6,type:"spring"},className:"text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-indigo-600 dark:from-purple-400 dark:to-indigo-400",children:["+",M.xp_earned," XP"]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Experience Earned"})]})]}),!m&&e.jsxs(r.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},className:"bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"text-xl font-bold text-purple-400/60 line-through mb-1",children:["+",Math.round(v.wpm*2.5)," XP"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Sign up to earn XP and track your progress!"}),e.jsx("button",{onClick:_,className:"mt-2 text-sm font-medium text-purple-600 dark:text-purple-400 hover:underline",children:"Create free account →"})]}),e.jsx("div",{className:"space-y-2 mb-6",children:y.map((i,b)=>e.jsxs("div",{className:`flex justify-between items-center p-3 rounded-lg ${i.beatGhost?"bg-green-50 dark:bg-green-900/20":"bg-gray-50 dark:bg-gray-700/50"}`,children:[e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2",children:["Round ",i.round,i.beatGhost&&e.jsx(q,{className:"w-4 h-4 text-yellow-500"})]}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 text-sm",children:[i.wpm," WPM | ",i.accuracy,"%"]})]},b))}),e.jsxs("button",{onClick:z,className:"px-8 py-3 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-lg font-semibold text-lg hover:from-purple-600 hover:to-indigo-700 transition-all flex items-center gap-2 mx-auto",children:[e.jsx(me,{className:"w-5 h-5"}),"Race Again"]})]}),e.jsx(ce,{isOpen:c,onClose:j,onSkip:w,context:"game"})]})}return e.jsx(ce,{isOpen:c,onClose:j,onSkip:w,context:"game"})},pt=()=>{const u=Re(),[d,m]=a.useState(!1),c=w=>{console.log("Ghost Mode completed:",w),m(!0)},j=()=>{u("/games/typing",{state:{gameCompleted:d}})};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-4 sm:py-8",children:e.jsx(qe,{onComplete:c,onExit:j})})};export{pt as GhostModePage,pt as default};
