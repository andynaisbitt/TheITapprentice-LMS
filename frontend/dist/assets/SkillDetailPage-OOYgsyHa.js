import{o as X,u as B,r as d,j as e,L as g,a5 as w,T as u,Z as k,a4 as D,a8 as _,G as E,a as F}from"./index-smch1bU1.js";import{s as m}from"./skillsApi-0HndmN36.js";import{A as G}from"./arrow-left-DyMd30wY.js";import{C as j}from"./clock-DNSf5APC.js";const z={tutorial:e.jsx(F,{className:"w-4 h-4"}),course:e.jsx(E,{className:"w-4 h-4"}),quiz:e.jsx(_,{className:"w-4 h-4"}),typing_game:e.jsx(D,{className:"w-4 h-4"}),achievement:e.jsx(w,{className:"w-4 h-4"})};function N(a){const i=new Date(a),h=new Date().getTime()-i.getTime(),t=Math.floor(h/6e4),c=Math.floor(t/60),l=Math.floor(c/24);return t<1?"just now":t<60?`${t}m ago`:c<24?`${c}h ago`:l<7?`${l}d ago`:i.toLocaleDateString()}function H(a){return a>=99?99:a>=75?75:a>=50?50:a>=30?30:a>=10?10:0}const R={10:"#6B7280",30:"#10B981",50:"#3B82F6",75:"#8B5CF6",99:"#F59E0B"},U=()=>{const{slug:a}=X(),{isAuthenticated:i}=B(),[o,h]=d.useState(null),[t,c]=d.useState(null),[l,S]=d.useState(null),[b,C]=d.useState([]),[P,y]=d.useState(!0),[p,f]=d.useState(null),[n,v]=d.useState("history");if(d.useEffect(()=>{(async()=>{if(a)try{y(!0),f(null);const s=await m.getSkill(a);h(s);const x=await m.getSkillLeaderboard(a,10);if(S(x),i){const $=(await m.getMySkills()).skills.find(T=>T.skillSlug===a);c($||null);const A=await m.getMyXPHistory(a,20);C(A.entries)}}catch(s){console.error("Failed to fetch skill data:",s),f(s.response?.data?.detail||"Failed to load skill data")}finally{y(!1)}})()},[a,i]),P)return e.jsx("div",{className:"max-w-5xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-24 mb-4"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded w-64 mb-8"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2 h-64 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsx("div",{className:"h-64 bg-gray-200 dark:bg-gray-700 rounded-lg"})]})]})});if(p||!o)return e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-12 text-center",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:[e.jsx("p",{className:"text-red-600 dark:text-red-400",children:p||"Skill not found"}),e.jsx(g,{to:"/skills",className:"mt-4 inline-block px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg",children:"Back to Skills"})]})});const L=t?Math.min(100,t.xpProgressPercentage):0,M=t?H(t.currentLevel):0;return e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[e.jsxs(g,{to:"/skills",className:"inline-flex items-center text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 mb-6",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Back to Skills"]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 sm:p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-5xl",children:o.icon}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:o.name}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:o.description})]})]}),t&&e.jsxs("div",{className:"md:ml-auto text-center md:text-right",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full text-white text-3xl font-bold shadow-lg",style:{backgroundColor:t.tierColor},children:t.currentLevel}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:`${t.tierColor}20`,color:t.tierColor},children:t.tier})})]})]}),t&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2",children:[e.jsxs("span",{children:[t.currentXp.toLocaleString()," XP"]}),e.jsxs("span",{children:[t.xpToNextLevel.toLocaleString()," XP to level ",t.currentLevel+1]})]}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${L}%`,backgroundColor:t.tierColor}})})]}),t&&e.jsx("div",{className:"mt-6 flex flex-wrap gap-3",children:[{level:10,achieved:t.level10Achieved,label:"Apprentice"},{level:30,achieved:t.level30Achieved,label:"Journeyman"},{level:50,achieved:t.level50Achieved,label:"Expert"},{level:75,achieved:t.level75Achieved,label:"Master"},{level:99,achieved:t.level99Achieved,label:"Grandmaster"}].map(r=>{const s=r.level===M,x=R[r.level]||"#6B7280";return e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-transform ${r.achieved?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-300 dark:border-yellow-700":"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600"} ${s?"ring-2 ring-offset-2 ring-offset-white dark:ring-offset-gray-800 scale-105":""}`,style:s?{borderColor:x,"--tw-ring-color":x}:void 0,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${r.achieved?"bg-yellow-400 text-yellow-900":"bg-gray-300 dark:bg-gray-600 text-gray-500"}`,children:r.level}),e.jsx("span",{className:r.achieved?"text-yellow-700 dark:text-yellow-400":"text-gray-500",children:r.label}),r.achieved&&e.jsx(w,{className:"w-4 h-4 text-yellow-500"}),s&&!r.achieved&&e.jsx("span",{className:"text-xs font-medium text-blue-500 dark:text-blue-400",children:"Current"})]},r.level)})})]}),e.jsxs("div",{className:"lg:hidden flex border-b border-gray-200 dark:border-gray-700 mb-4",children:[e.jsxs("button",{onClick:()=>v("history"),className:`flex-1 py-2.5 text-sm font-medium text-center transition-colors ${n==="history"?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(j,{className:"w-4 h-4 inline mr-1.5"}),"XP History"]}),e.jsxs("button",{onClick:()=>v("players"),className:`flex-1 py-2.5 text-sm font-medium text-center transition-colors ${n==="players"?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(u,{className:"w-4 h-4 inline mr-1.5"}),"Top Players"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:`lg:col-span-2 ${n!=="history"?"hidden lg:block":""}`,children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 sm:p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5"}),"Recent XP Gains"]}),i?b.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(k,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No XP earned yet for this skill"}),e.jsx("p",{className:"text-sm mt-1",children:"Complete tutorials, courses, or quizzes to earn XP!"})]}):e.jsx("div",{className:"space-y-2 sm:space-y-3",children:b.map(r=>e.jsxs("div",{className:"flex items-center gap-3 p-2 sm:p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-600 dark:text-green-400 flex-shrink-0",children:z[r.sourceType]||e.jsx(k,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:["+",r.xpGained," XP"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:[r.sourceType.replace("_"," "),r.sourceMetadata?.tutorial_title?`: ${String(r.sourceMetadata.tutorial_title)}`:null,r.sourceMetadata?.quiz_title?`: ${String(r.sourceMetadata.quiz_title)}`:null,r.sourceMetadata?.course_title?`: ${String(r.sourceMetadata.course_title)}`:null]})]}),e.jsxs("div",{className:"text-sm text-gray-400 flex-shrink-0",children:[e.jsx("span",{className:"hidden sm:inline",children:N(r.createdAt)}),e.jsx("span",{className:"sm:hidden",children:N(r.createdAt).replace(" ago","")})]}),r.levelBefore<r.levelAfter&&e.jsx("div",{className:"px-2 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 rounded text-sm font-medium flex-shrink-0",children:"Level up!"})]},r.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Sign in to track your XP history"}),e.jsx(g,{to:"/login",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg",children:"Sign In"})]})]})}),e.jsx("div",{className:`${n!=="players"?"hidden lg:block":""}`,children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 sm:p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5 text-yellow-500"}),"Top Players"]}),l&&l.entries.length>0?e.jsx("div",{className:"space-y-2",children:l.entries.map((r,s)=>e.jsxs("div",{className:`flex items-center gap-3 p-2 rounded-lg ${s<3?"bg-yellow-50 dark:bg-yellow-900/10":""}`,children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${s===0?"bg-yellow-400 text-yellow-900":s===1?"bg-gray-300 text-gray-700":s===2?"bg-amber-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:r.rank}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white text-sm",children:r.username})}),e.jsx("div",{className:"px-2 py-1 rounded text-xs font-bold text-white",style:{backgroundColor:r.tierColor},children:r.level})]},r.userId))}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(u,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No rankings yet"})]}),l&&l.userRank&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Your rank:"}),e.jsxs("span",{className:"font-bold text-gray-900 dark:text-white",children:["#",l.userRank," of ",l.totalParticipants]})]})}),e.jsx(g,{to:"/skills/leaderboard",className:"mt-4 block text-center text-blue-600 hover:text-blue-700 dark:text-blue-400 text-sm",children:"View Full Leaderboard"})]})})]})]})};export{U as SkillDetailPage,U as default};
