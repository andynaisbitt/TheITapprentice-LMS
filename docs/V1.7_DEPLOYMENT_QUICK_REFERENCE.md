# v1.7 Deployment Quick Reference

**Ultra-fast deployment checklist for production VM**

---

## üöÄ 30-Second Overview

v1.7 adds **6 major features**:
1. Blog category filtering fix
2. Mobile carousel optimization
3. User registration system
4. Admin user management
5. **Google OAuth login** (needs setup)
6. **Email verification** (needs setup)

**Database changes:** YES (migration required)
**Breaking changes:** NO (backward compatible)
**Rollback available:** YES

---

## üìã Pre-Flight Checklist

```bash
# 1. Backup everything
mkdir -p ~/backups/pre-v1.7-$(date +%Y%m%d)
cd ~/backups/pre-v1.7-$(date +%Y%m%d)
sudo -u postgres pg_dump blogcms_db > database_backup.sql
cp -r /var/www/fastreactcms fastreactcms-backup

# 2. Pull v1.7
cd /var/www/fastreactcms
git fetch origin
git pull origin master
git log -1 --grep="v1.7"  # Verify commit 701791d

# 3. Run database migration
cd backend
alembic upgrade head

# 4. Install frontend dependencies
cd ../frontend
npm install

# 5. Build frontend
npm run build

# 6. Restart services
sudo systemctl restart fastreactcms
sudo systemctl restart fastreactcms-ssr
sudo systemctl restart nginx

# 7. Verify
curl -s https://theitapprentice.com/health
curl -s https://theitapprentice.com | grep -o "<title>.*</title>"
```

---

## üîç Quick Checks

**Backend health:**
```bash
curl https://theitapprentice.com/api/v1/health
# Expected: {"status":"healthy"...}
```

**Frontend pages:**
```bash
curl -I https://theitapprentice.com/register
curl -I https://theitapprentice.com/verify-email
curl -I https://theitapprentice.com/admin/users
# Expected: 200 OK
```

**Database migration:**
```bash
cd /var/www/fastreactcms/backend
alembic current
# Expected: v1_7_oauth_email_verification (head)
```

**Check for errors:**
```bash
sudo journalctl -u fastreactcms -n 50 | grep -i "error\|fail"
# Expected: No critical errors
```

---

## ‚öôÔ∏è Configuration Files

### Backend .env (Required)
```env
# Already configured:
DATABASE_URL=postgresql://...
SECRET_KEY=...

# NEW - Add these (can leave empty initially):
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
SENDGRID_API_KEY=
EMAIL_FROM=noreply@theitapprentice.com
FRONTEND_URL=https://theitapprentice.com
```

### Frontend .env (Required)
```env
# Already configured:
VITE_API_URL=https://theitapprentice.com

# NEW - Add this (can leave empty initially):
VITE_GOOGLE_CLIENT_ID=
```

---

## üîê Optional Setup (Can Do Later)

### Google OAuth (15 min)
**Full guide:** `docs/GOOGLE_OAUTH_PRODUCTION_SETUP.md`

**Quick steps:**
1. Create Google Cloud project
2. Configure OAuth consent screen
3. Create OAuth client ID
4. Add Client ID to frontend `.env`
5. Add Client ID + Secret to backend `.env`
6. Rebuild frontend: `npm run build`
7. Restart: `sudo systemctl restart fastreactcms fastreactcms-ssr`

### Email Verification (10 min)
**Full guide:** `docs/GOOGLE_OAUTH_PRODUCTION_SETUP.md` (Step 4)

**Quick steps:**
1. Get SendGrid API key (free tier)
2. Add to backend `.env`: `SENDGRID_API_KEY=...`
3. Restart: `sudo systemctl restart fastreactcms`

---

## üêõ Troubleshooting

### Build Fails
```bash
cd /var/www/fastreactcms/frontend
rm -rf node_modules package-lock.json
npm install
npm run build
```

### Migration Fails
```bash
# Check current state
cd /var/www/fastreactcms/backend
alembic current

# Manual migration (if needed)
psql -U blogcms_user -d blogcms_db -f manual_migration.sql
```

### Backend Won't Start
```bash
sudo journalctl -u fastreactcms -n 100 --no-pager
# Check for import errors or database connection issues

# Reinstall dependencies
cd /var/www/fastreactcms/backend
pip install -r requirements.txt
```

### 404 on New Pages
```bash
# Rebuild frontend
cd /var/www/fastreactcms/frontend
npm run build

# Clear cache
sudo systemctl restart fastreactcms-ssr nginx
```

---

## üîÑ Rollback Plan

**If deployment fails:**

```bash
cd /var/www/fastreactcms

# 1. Restore code
git log -5 --oneline
git reset --hard 1f90684  # Commit before v1.7

# 2. Rollback database
cd backend
alembic downgrade -1

# 3. Rebuild and restart
cd ../frontend
npm run build
sudo systemctl restart fastreactcms fastreactcms-ssr nginx

# 4. Verify
curl https://theitapprentice.com/health
```

---

## üìä Success Criteria

**v1.7 deployed successfully if:**

- [x] Website loads (no 500 errors)
- [x] Homepage displays correctly
- [x] `/login` page loads
- [x] `/register` page loads
- [x] `/verify-email` page loads
- [x] `/admin/users` page loads (when logged in)
- [x] No errors in backend logs
- [x] Database migration completed
- [x] Frontend built successfully

**OAuth/Email optional - can configure later!**

---

## üìö Full Documentation

- **Complete deployment:** `docs/V1.7_PRODUCTION_DEPLOYMENT.md`
- **Google OAuth setup:** `docs/GOOGLE_OAUTH_PRODUCTION_SETUP.md`
- **Feature summary:** `docs/V1.7_COMPLETE_SUMMARY.md`
- **Release notes:** `docs/V1.7_RELEASE_NOTES.md`

---

## üÜò Emergency Contacts

**Logs:**
```bash
# Backend
sudo journalctl -u fastreactcms -n 100 --follow

# Frontend SSR
sudo journalctl -u fastreactcms-ssr -n 100 --follow

# Nginx
sudo tail -f /var/log/nginx/error.log
```

**Status:**
```bash
sudo systemctl status fastreactcms
sudo systemctl status fastreactcms-ssr
sudo systemctl status nginx
sudo systemctl status postgresql
```

---

**Last Updated:** 2026-01-11
**Version:** 1.7
**Migration:** v1_7_oauth_email_verification
