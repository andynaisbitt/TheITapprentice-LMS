# v1.7.1 Plugin System - Quick Start Guide

**Goal**: Get tutorials and typing game working in BlogCMS in 3 weeks
**Strategy**: Copy from ITAppBetaV1 â†’ Adapt for BlogCMS â†’ Test â†’ Deploy

---

## ðŸ“‹ Prerequisites

### What You Need
- âœ… FastReactCMS (BlogCMS) - v1.7 deployed at theitapprentice.com
- âœ… ITAppBetaV1 - Local development copy at `C:\Gitlab Projects\ITAppBetaV1`
- âœ… Both projects running locally for testing

### Check Current State
```bash
# BlogCMS
cd "C:\Gitlab Projects\BlogCMS"
git status
git log -3 --oneline

# ITAppBetaV1
cd "C:\Gitlab Projects\ITAppBetaV1"
git status
ls -la Backend/app/api/v1/services  # Should see: tutorials/, games/
```

---

## ðŸš€ Week 1: Tutorials Plugin

### Day 1-2: Backend Setup

#### Step 1: Create Plugin Folder Structure
```bash
cd "C:\Gitlab Projects\BlogCMS\backend\app"

# Create plugins folder
mkdir plugins
mkdir plugins\tutorials
mkdir plugins\shared

# Create __init__.py files
type nul > plugins\__init__.py
type nul > plugins\tutorials\__init__.py
type nul > plugins\shared\__init__.py
```

#### Step 2: Copy Tutorial Models
```bash
# Copy from ITAppBetaV1
copy "C:\Gitlab Projects\ITAppBetaV1\Backend\app\api\v1\services\tutorials\models.py" ^
     "C:\Gitlab Projects\BlogCMS\backend\app\plugins\tutorials\models.py"

copy "C:\Gitlab Projects\ITAppBetaV1\Backend\app\api\v1\services\tutorials\schemas.py" ^
     "C:\Gitlab Projects\BlogCMS\backend\app\plugins\tutorials\schemas.py"

copy "C:\Gitlab Projects\ITAppBetaV1\Backend\app\api\v1\services\tutorials\crud.py" ^
     "C:\Gitlab Projects\BlogCMS\backend\app\plugins\tutorials\crud.py"

copy "C:\Gitlab Projects\ITAppBetaV1\Backend\app\api\v1\services\tutorials\routes.py" ^
     "C:\Gitlab Projects\BlogCMS\backend\app\plugins\tutorials\routes.py"
```

#### Step 3: Update Imports in Copied Files
Edit each copied file and update imports:

```python
# OLD (ITAppBetaV1):
from app.api.v1.services.tutorials.models import Tutorial
from app.core.dependencies import get_db

# NEW (BlogCMS):
from app.plugins.tutorials.models import Tutorial
from app.core.database import get_db
from app.users.models import User
from app.auth.dependencies import get_current_user, require_admin
```

#### Step 4: Add Plugin Configuration
Edit `backend/app/core/config.py`:

```python
class Settings(BaseSettings):
    # ... existing settings ...

    # Plugin System (v1.7.1)
    PLUGINS_ENABLED: dict = {
        "tutorials": True,       # Enable tutorials by default
        "typing_game": True,     # Enable typing game
        "courses": False,        # Disabled by default
        "quizzes": False,
    }
```

#### Step 5: Create Database Migration
```bash
cd "C:\Gitlab Projects\BlogCMS\backend"

# Activate venv
venv\Scripts\activate

# Create migration
alembic revision --autogenerate -m "v1.7.1 - Add tutorials plugin tables"

# Review the migration file
# Should create: tutorials, tutorial_steps, tutorial_categories, tutorial_progress tables

# Apply migration (locally first!)
alembic upgrade head
```

#### Step 6: Mount Tutorial Routes
Edit `backend/app/main.py`:

```python
from app.core.config import settings

# Import tutorial routes
from app.plugins.tutorials.routes import router as tutorials_router

# ... after existing route includes ...

# Conditionally include plugins
if settings.PLUGINS_ENABLED.get("tutorials", False):
    app.include_router(
        tutorials_router,
        prefix="/api/v1/tutorials",
        tags=["tutorials"]
    )
    print("âœ… Tutorials plugin enabled")
```

#### Step 7: Test Backend
```bash
# Start backend
cd "C:\Gitlab Projects\BlogCMS\backend"
uvicorn app.main:app --reload

# Test in browser:
# http://localhost:8000/docs
# Should see new endpoints:
# - GET /api/v1/tutorials
# - GET /api/v1/tutorials/{slug}
# - POST /api/v1/tutorials/{id}/complete
```

---

### Day 3-4: Frontend Setup

#### Step 1: Create Plugin Folder Structure
```bash
cd "C:\Gitlab Projects\BlogCMS\frontend\src"

# Create plugins folder
mkdir plugins
mkdir plugins\tutorials
mkdir plugins\tutorials\components
mkdir plugins\tutorials\pages
mkdir plugins\tutorials\services
mkdir plugins\tutorials\types
```

#### Step 2: Copy Tutorial Components
```bash
# Copy pages
copy "C:\Gitlab Projects\ITAppBetaV1\src\pages\tutorials\TutorialsList.tsx" ^
     "C:\Gitlab Projects\BlogCMS\frontend\src\plugins\tutorials\pages\TutorialsList.tsx"

copy "C:\Gitlab Projects\ITAppBetaV1\src\pages\tutorials\TutorialViewer.tsx" ^
     "C:\Gitlab Projects\BlogCMS\frontend\src\plugins\tutorials\pages\TutorialViewer.tsx"

# Copy API client
copy "C:\Gitlab Projects\ITAppBetaV1\src\services\api\tutorials.api.ts" ^
     "C:\Gitlab Projects\BlogCMS\frontend\src\plugins\tutorials\services\tutorials.api.ts"
```

#### Step 3: Install Frontend Dependencies
```bash
cd "C:\Gitlab Projects\BlogCMS\frontend"

npm install react-syntax-highlighter @types/react-syntax-highlighter
npm install canvas-confetti @types/canvas-confetti
```

#### Step 4: Update API Client
Edit `frontend/src/plugins/tutorials/services/tutorials.api.ts`:

```typescript
// Change base URL
import { apiClient } from '../../../services/api/client';

// Update endpoints (remove /services/ prefix)
export const tutorialsApi = {
  getTutorials: async (params?: TutorialFilters) => {
    const response = await apiClient.get<TutorialListResponse[]>('/api/v1/tutorials', { params });
    return response.data;
  },

  getTutorialBySlug: async (slug: string) => {
    const response = await apiClient.get<TutorialDetailResponse>(`/api/v1/tutorials/${slug}`);
    return response.data;
  },

  // ... other methods
};
```

#### Step 5: Create Plugin Configuration
Create `frontend/src/plugins/tutorials/plugin.config.ts`:

```typescript
export const tutorialsPluginConfig = {
  id: 'tutorials',
  name: 'Tutorials',
  description: 'Step-by-step interactive learning guides',
  version: '1.0.0',
  icon: 'BookOpen',
  enabled: true,  // Can be toggled from admin
  routes: [
    { path: '/tutorials', label: 'Browse Tutorials' },
    { path: '/tutorials/:slug', label: 'Tutorial Viewer' },
  ],
};
```

#### Step 6: Add Plugin Routes
Edit `frontend/src/routes/routes.tsx`:

```typescript
// Add lazy imports
const TutorialsList = lazy(() => import('../plugins/tutorials/pages/TutorialsList'));
const TutorialViewer = lazy(() => import('../plugins/tutorials/pages/TutorialViewer'));

// Add routes (in AppRoutes component)
export const AppRoutes = () => {
  return (
    <Routes>
      {/* ... existing routes ... */}

      {/* Tutorials Plugin Routes */}
      <Route
        path="/tutorials"
        element={
          <Layout>
            <TutorialsList />
          </Layout>
        }
      />
      <Route
        path="/tutorials/:slug"
        element={
          <Layout>
            <TutorialViewer />
          </Layout>
        }
      />
    </Routes>
  );
};
```

#### Step 7: Update Navigation
Edit `frontend/src/components/layout/Header.tsx`:

```tsx
import { BookOpen } from 'lucide-react';

// Add to navigation menu (in the user menu or main nav)
<Link
  to="/tutorials"
  className="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"
>
  <BookOpen size={18} />
  Tutorials
</Link>
```

#### Step 8: Test Frontend
```bash
# Start frontend
cd "C:\Gitlab Projects\BlogCMS\frontend"
npm run dev

# Test in browser:
# http://localhost:5173/tutorials
# Should see tutorials list (empty if no data)
```

---

### Day 5: Seed Tutorial Data & Test

#### Create Seed Script
Create `backend/scripts/seed_tutorials.py`:

```python
import sys
from pathlib import Path
sys.path.append(str(Path(__file__).parent.parent))

from sqlalchemy.orm import Session
from app.core.database import SessionLocal
from app.plugins.tutorials.models import Tutorial, TutorialStep, TutorialCategory

def seed_tutorials():
    db = SessionLocal()

    # Create category
    category = TutorialCategory(
        name="Python Basics",
        slug="python-basics",
        icon="Code",
        color="#3776ab",
        description="Learn Python programming fundamentals"
    )
    db.add(category)
    db.commit()
    db.refresh(category)

    # Create tutorial
    tutorial = Tutorial(
        title="Your First Python Script",
        slug="first-python-script",
        description="Learn to write your first Python program",
        difficulty="beginner",
        estimated_time_minutes=15,
        xp_reward=50,
        is_published=True,
        category_id=category.id
    )
    db.add(tutorial)
    db.commit()
    db.refresh(tutorial)

    # Create steps
    steps = [
        TutorialStep(
            tutorial_id=tutorial.id,
            order=1,
            title="Install Python",
            content="First, make sure Python is installed on your system...",
            code_example=None,
            code_language=None
        ),
        TutorialStep(
            tutorial_id=tutorial.id,
            order=2,
            title="Write Hello World",
            content="Create a new file called `hello.py` and add the following code:",
            code_example='print("Hello, World!")',
            code_language="python"
        ),
        TutorialStep(
            tutorial_id=tutorial.id,
            order=3,
            title="Run Your Script",
            content="Open a terminal and run your script:",
            code_example="python hello.py",
            code_language="bash"
        ),
    ]

    for step in steps:
        db.add(step)

    db.commit()
    print("âœ… Seeded 1 tutorial with 3 steps")

if __name__ == "__main__":
    seed_tutorials()
```

#### Run Seed Script
```bash
cd "C:\Gitlab Projects\BlogCMS\backend"
python scripts/seed_tutorials.py
```

#### Test Tutorial Viewing
1. Visit http://localhost:5173/tutorials
2. Should see "Your First Python Script" card
3. Click to view tutorial
4. Should see 3 steps with code examples
5. Test marking steps as complete (requires login)

---

## ðŸš€ Week 2: Typing Game Plugin

### Day 1-2: Backend Setup

#### Step 1: Create Plugin Folder
```bash
cd "C:\Gitlab Projects\BlogCMS\backend\app\plugins"

mkdir typing_game
type nul > typing_game\__init__.py
```

#### Step 2: Copy Game Models
```bash
copy "C:\Gitlab Projects\ITAppBetaV1\Backend\app\api\v1\services\games\models.py" ^
     "C:\Gitlab Projects\BlogCMS\backend\app\plugins\typing_game\models.py"

copy "C:\Gitlab Projects\ITAppBetaV1\Backend\app\api\v1\services\games\schemas.py" ^
     "C:\Gitlab Projects\BlogCMS\backend\app\plugins\typing_game\schemas.py"

copy "C:\Gitlab Projects\ITAppBetaV1\Backend\app\api\v1\services\games\routes.py" ^
     "C:\Gitlab Projects\BlogCMS\backend\app\plugins\typing_game\routes.py"

copy "C:\Gitlab Projects\ITAppBetaV1\Backend\app\api\v1\services\games\scoring.py" ^
     "C:\Gitlab Projects\BlogCMS\backend\app\plugins\typing_game\scoring.py"
```

#### Step 3: Update Imports

#### Step 4: Create Migration
```bash
alembic revision --autogenerate -m "v1.7.1 - Add typing game plugin tables"
alembic upgrade head
```

#### Step 5: Mount Routes
Edit `backend/app/main.py`:

```python
from app.plugins.typing_game.routes import router as typing_game_router

if settings.PLUGINS_ENABLED.get("typing_game", False):
    app.include_router(
        typing_game_router,
        prefix="/api/v1/games/typing",
        tags=["typing_game"]
    )
    print("âœ… Typing game plugin enabled")
```

---

### Day 3-4: Frontend Setup

#### Step 1: Create Plugin Folder
```bash
cd "C:\Gitlab Projects\BlogCMS\frontend\src\plugins"

mkdir typing-game
mkdir typing-game\components
mkdir typing-game\components\PVP
mkdir typing-game\pages
mkdir typing-game\hooks
```

#### Step 2: Copy Components
```bash
# Copy main game
copy "C:\Gitlab Projects\ITAppBetaV1\src\components\Games\TypingGame\QuickBrownFoxGameV3.tsx" ^
     "C:\Gitlab Projects\BlogCMS\frontend\src\plugins\typing-game\components\QuickBrownFoxGame.tsx"

# Copy PVP components (7 files)
xcopy "C:\Gitlab Projects\ITAppBetaV1\src\components\Games\PVP\*" ^
      "C:\Gitlab Projects\BlogCMS\frontend\src\plugins\typing-game\components\PVP\" /S

# Copy API hook
copy "C:\Gitlab Projects\ITAppBetaV1\src\components\Games\TypingGame\hooks\useQuickBrownFoxAPI.ts" ^
     "C:\Gitlab Projects\BlogCMS\frontend\src\plugins\typing-game\hooks\useTypingGameAPI.ts"
```

#### Step 3: Add Routes
Edit `frontend/src/routes/routes.tsx`:

```typescript
const TypingGame = lazy(() => import('../plugins/typing-game/pages/TypingGamePage'));

// Add route
<Route
  path="/games/typing"
  element={
    <Layout>
      <TypingGame />
    </Layout>
  }
/>
```

#### Step 4: Update Navigation
```tsx
<Link to="/games/typing">
  <Gamepad size={18} />
  Typing Game
</Link>
```

---

## ðŸš€ Week 3: Plugin Management System

### Create Admin Plugin Manager

#### Backend: Plugin Status API
Create `backend/app/api/v1/endpoints/admin/plugins.py`:

```python
@router.get("/admin/plugins")
async def get_plugins_status(
    current_user: User = Depends(require_admin),
    db: Session = Depends(get_db)
):
    """Get all plugins and their status"""
    return {
        "tutorials": {
            "installed": True,
            "enabled": settings.PLUGINS_ENABLED.get("tutorials", False),
            "version": "1.0.0",
            "total_items": db.query(Tutorial).count()
        },
        "typing_game": {
            "installed": True,
            "enabled": settings.PLUGINS_ENABLED.get("typing_game", False),
            "version": "1.0.0",
            "total_sessions": db.query(GameSession).count()
        }
    }

@router.post("/admin/plugins/{plugin_id}/toggle")
async def toggle_plugin(
    plugin_id: str,
    enabled: bool,
    current_user: User = Depends(require_admin)
):
    """Enable/disable plugin"""
    settings.PLUGINS_ENABLED[plugin_id] = enabled
    # TODO: Persist to database
    return {"success": True, "plugin_id": plugin_id, "enabled": enabled}
```

#### Frontend: Plugin Manager Page
Create `frontend/src/pages/admin/PluginManager.tsx`:

```tsx
export const PluginManager = () => {
  const [plugins, setPlugins] = useState<any>({});

  useEffect(() => {
    fetch('/api/v1/admin/plugins')
      .then(res => res.json())
      .then(setPlugins);
  }, []);

  const togglePlugin = async (pluginId: string, enabled: boolean) => {
    await fetch(`/api/v1/admin/plugins/${pluginId}/toggle`, {
      method: 'POST',
      body: JSON.stringify({ enabled }),
      headers: { 'Content-Type': 'application/json' }
    });
    // Refresh
    window.location.reload();
  };

  return (
    <div className="plugin-manager">
      <h1>Plugin Manager</h1>
      {Object.entries(plugins).map(([id, plugin]: any) => (
        <div key={id} className="plugin-card">
          <h3>{id}</h3>
          <p>Version: {plugin.version}</p>
          <button onClick={() => togglePlugin(id, !plugin.enabled)}>
            {plugin.enabled ? 'Disable' : 'Enable'}
          </button>
        </div>
      ))}
    </div>
  );
};
```

---

## ðŸ§ª Testing Checklist

### Week 1: Tutorials
- [ ] Backend running without errors
- [ ] Migration applied successfully
- [ ] Seed script creates tutorial
- [ ] GET /api/v1/tutorials returns data
- [ ] Frontend shows tutorials list
- [ ] Can view tutorial steps
- [ ] Code syntax highlighting works
- [ ] Can mark steps as complete (logged in)
- [ ] XP awarded on completion

### Week 2: Typing Game
- [ ] Backend running without errors
- [ ] Migration applied successfully
- [ ] GET /api/v1/games/typing endpoints work
- [ ] Can start game session
- [ ] WPM/accuracy calculated correctly
- [ ] Can submit scores
- [ ] XP awarded based on performance
- [ ] Leaderboard shows top scores
- [ ] PVP matchmaking works (optional for v1)

### Week 3: Plugin Manager
- [ ] Admin can view plugin status
- [ ] Can toggle plugins on/off
- [ ] Navigation updates dynamically
- [ ] Routes protected when plugin disabled
- [ ] Settings persist across restarts

---

## ðŸš€ Deployment to Production

### Step 1: Commit Changes
```bash
cd "C:\Gitlab Projects\BlogCMS"

git add .
git commit -m "feat: v1.7.1 - Add tutorials and typing game plugins

- Created plugin system architecture
- Added tutorials plugin (browse, view, complete)
- Added typing game plugin (solo + PVP)
- Added admin plugin manager
- Database migrations for new tables
"

git push origin master
```

### Step 2: Deploy to Production
```bash
# SSH to production VM
ssh user@theitapprentice.com

cd /var/www/fastreactcms

# Pull latest
git pull origin master

# Backend migrations
cd backend
source venv/bin/activate
alembic upgrade head

# Frontend build
cd ../frontend
npm install  # In case new dependencies
npm run build

# Restart services
sudo systemctl restart fastreactcms
sudo systemctl restart fastreactcms-ssr

# Check logs
sudo journalctl -u fastreactcms -f
```

### Step 3: Test Production
- Visit https://theitapprentice.com/tutorials
- Visit https://theitapprentice.com/games/typing
- Visit https://theitapprentice.com/admin/plugins

---

## ðŸŽ¯ Success Criteria

**v1.7.1 Complete When:**
- âœ… Tutorials plugin working (browse, view, complete)
- âœ… Typing game plugin working (solo play)
- âœ… Plugin manager in admin panel
- âœ… Navigation dynamically updates
- âœ… All features work in production
- âœ… No regressions in existing features

---

**Status**: ðŸ“‹ READY TO START
**Estimated Time**: 3 weeks (15 work days)
**Next Action**: Create `backend/app/plugins/` folder and begin Week 1
**Last Updated**: 2026-01-11
