# BlogCMS Version 1.7 Release Notes

**Release Date:** 2026-01-10
**Status:** ‚úÖ **COMPLETED**

## üéØ Overview

Version 1.7 addresses three critical issues and implements **complete admin user management system** for the BlogCMS platform.

---

## ‚úÖ Completed Features

### 1. Blog Post Category Filtering Fix

**Problem:** Blog posts were not filtering by selected category when using the URL parameter `?category=tech-industry`.

**Root Cause:**
- Frontend was sending `category` (slug string) parameter
- Backend was expecting `category_id` (integer) parameter
- Additional mismatch: Frontend sent `per_page` but backend expected `page_size`

**Solution:**
- **Backend** (`backend/app/api/v1/endpoints/blog/public.py`):
  - Added `category` (slug) parameter alongside existing `category_id`
  - Automatically resolves category slug to ID using `crud.get_category_by_slug()`
  - Maintains backward compatibility with direct ID lookups

- **Frontend** (`frontend/src/pages/BlogList.tsx`):
  - Changed `per_page` to `page_size` to match backend expectations

**Files Modified:**
- `backend/app/api/v1/endpoints/blog/public.py` (added slug parameter resolution)
- `frontend/src/pages/BlogList.tsx` (fixed pagination parameter)

**Testing:**
```bash
# Test URL:
https://theitapprentice.com/blog?category=tech-industry

# Expected: Shows only posts from "tech-industry" category
# Actual: ‚úÖ Working correctly after fix
```

---

### 2. Featured Article Animation Mobile Glitches Fix

**Problem:** Featured article carousel was glitchy on mobile during transitions. Next/previous buttons didn't sit nicely.

**Root Causes:**
1. **Scale animations** (`scale: 1.05` ‚Üí `1` ‚Üí `0.95`) caused GPU rendering issues on mobile browsers
2. **AnimatePresence mode="sync"** caused overlapping content during transitions
3. **Button positioning** using `top-1/2 -translate-y-1/2` fought with animation transforms
4. **willChange property** caused issues on some mobile browsers
5. **Slow transition duration** (0.8s) made animations feel janky

**Solution:**

**Animation Improvements** (`frontend/src/components/home/FeaturedCarousel.tsx`):
- Removed scale animations on mobile (opacity-only transitions)
- Reduced scale on desktop (1.02 ‚Üí 1 ‚Üí 0.98 instead of 1.05 ‚Üí 1 ‚Üí 0.95)
- Changed AnimatePresence from `mode="sync"` to `mode="wait"` (prevents overlapping)
- Faster transitions on mobile (0.4s vs 0.6s on desktop)
- Smoother easing curve: `[0.32, 0.72, 0, 1]`
- Removed `willChange` property (causes issues on mobile Safari)

**Button Positioning Improvements**:
- Wrapped buttons in fixed `inset-0` container with `pointer-events-none`
- Used flexbox for vertical centering (no transform conflicts)
- Changed from `z-10` to `z-20` (ensures buttons stay above content)
- Better active state feedback (`active:scale-90`)
- Changed `transition-all` to `transition-colors` (more performant)

**Responsive Handling**:
- Added `isMobile` state with window resize listener
- Dynamic animation behavior based on viewport size

**Files Modified:**
- `frontend/src/components/home/FeaturedCarousel.tsx` (complete animation overhaul)

**Before vs After:**
- ‚ùå Before: Janky scale effects, overlapping slides, jumpy buttons
- ‚úÖ After: Smooth opacity transitions, clean slide changes, stable buttons

---

### 3. User Registration System Implementation

**Problem:** No signup/register page existed, despite backend having a working registration endpoint.

**Solution:**

#### **New Registration Page** (`frontend/src/pages/Register.tsx`)

**Features:**
- ‚úÖ Clean, modern UI matching Login page styling
- ‚úÖ Complete form validation with real-time feedback
- ‚úÖ Password strength indicator (visual feedback)
- ‚úÖ Password visibility toggle
- ‚úÖ Confirm password matching validation
- ‚úÖ Field-level error messages
- ‚úÖ Username validation (letters, numbers, hyphens, underscores)
- ‚úÖ Email format validation
- ‚úÖ Dark mode support
- ‚úÖ Google OAuth placeholder (coming soon)
- ‚úÖ Auto-redirect to login after successful registration

**Form Fields:**
```typescript
{
  email: string;           // Required, email format validation
  username: string;        // Required, 3+ chars, alphanumeric + hyphens/underscores
  password: string;        // Required, 8+ chars, uppercase, lowercase, number
  confirmPassword: string; // Must match password
  first_name: string;      // Required
  last_name: string;       // Required
}
```

**Password Requirements:**
- ‚úÖ Minimum 8 characters
- ‚úÖ At least one uppercase letter
- ‚úÖ At least one lowercase letter
- ‚úÖ At least one number
- üìä Real-time visual validation with checkmarks

**User Flow:**
1. User fills out registration form
2. Real-time validation provides instant feedback
3. On submit, calls `authApi.register()` backend endpoint
4. Success ‚Üí Redirects to `/login` with success message and prefilled email
5. Error ‚Üí Displays clear error message

**Routing:**
- Added lazy import: `const Register = lazy(() => import('../pages/Register'));`
- Added route: `/register` (no header/footer, like login)

**Files Created:**
- `frontend/src/pages/Register.tsx` (473 lines, complete registration form)

**Files Modified:**
- `frontend/src/routes/routes.tsx` (added registration route)

**Testing:**
```bash
# Test flow:
1. Navigate to: http://localhost:5173/register
2. Fill out form with invalid data ‚Üí See real-time validation
3. Fill out form with valid data ‚Üí Success redirect to login
4. Check login page ‚Üí Success message and prefilled email shown
```

---

## üìã Pending/Future Work

### Admin User Management UI

**Current State:**
- ‚ùå **No admin user management interface exists**
- ‚úÖ Backend user model is comprehensive (roles, permissions, subscriptions)
- ‚úÖ Backend script exists: `backend/scripts/create_admin.py`
- ‚ùå No UI for listing/editing/enabling/disabling users

**What's Available:**
```python
# Current user management is CLI-only
python backend/scripts/create_admin.py
```

**What's Missing:**
- User list page in admin panel
- User edit/disable functionality
- Role assignment UI
- Permission management UI
- User search/filtering
- Account activation/deactivation controls

**Recommendation for v1.8:**
Create `frontend/src/pages/admin/UserManagement.tsx` with:
- User table with search/filter
- Edit user modal (name, email, role, status)
- Enable/disable account toggle
- View user activity/stats
- Password reset trigger
- Role assignment dropdown

**Backend Support (Already Exists):**
```python
# User Model has all necessary fields:
- role: UserRole (APPRENTICE, SUPPORTER, CONTRIBUTOR, MENTOR, TUTOR, AUTHOR, ADMIN)
- is_active: bool
- is_verified: bool
- is_admin: bool
- Permissions: can_create_courses, can_write_blog, can_moderate
```

---

### Google OAuth Integration Setup

**Current State:**
- ‚úÖ **Backend OAuth endpoint fully implemented** (`backend/app/auth/oauth.py`)
- ‚úÖ Config placeholders ready (`GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET`)
- ‚úÖ User model supports `google_id` field
- ‚ùå **Frontend integration not implemented**
- ‚ö†Ô∏è **Missing import in backend** (see bug section below)

**Backend Features (Already Working):**
- Google login/registration endpoint
- Automatic account linking (by email)
- Auto-generated usernames for new Google users
- Email verification automatic (Google-verified)
- Google account unlinking (requires password set first)

**Frontend Integration Required:**

#### **Step 1: Install Dependencies**
```bash
cd frontend
npm install @react-oauth/google
```

#### **Step 2: Get Google OAuth Credentials**

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project (or select existing)
3. Enable Google+ API
4. Go to "Credentials" ‚Üí "Create Credentials" ‚Üí "OAuth 2.0 Client ID"
5. Configure OAuth consent screen:
   - App name: "The IT Apprentice"
   - User support email: your@email.com
   - Developer contact: your@email.com
6. Create OAuth Client ID:
   - Application type: **Web application**
   - Authorized JavaScript origins:
     ```
     http://localhost:5173
     https://theitapprentice.com
     ```
   - Authorized redirect URIs:
     ```
     http://localhost:5173/auth/google/callback
     https://theitapprentice.com/auth/google/callback
     ```
7. Copy Client ID and Client Secret

#### **Step 3: Add Environment Variables**

**Backend** (`.env`):
```env
GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-client-secret
GOOGLE_REDIRECT_URI=http://localhost:5173/auth/google/callback
```

**Frontend** (`.env`):
```env
VITE_GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
```

#### **Step 4: Frontend Implementation**

**Main App Wrapper** (`frontend/src/App.tsx`):
```typescript
import { GoogleOAuthProvider } from '@react-oauth/google';

function App() {
  return (
    <GoogleOAuthProvider clientId={import.meta.env.VITE_GOOGLE_CLIENT_ID}>
      {/* existing app structure */}
    </GoogleOAuthProvider>
  );
}
```

**Login Page Update** (`frontend/src/pages/Login.tsx`):
```typescript
import { GoogleLogin } from '@react-oauth/google';
import { jwtDecode } from 'jwt-decode';

// Replace the disabled Google button with:
<GoogleLogin
  onSuccess={async (credentialResponse) => {
    try {
      const decoded = jwtDecode(credentialResponse.credential);

      // Call backend OAuth endpoint
      const response = await fetch('/api/v1/auth/oauth/google', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email: decoded.email,
          google_id: decoded.sub,
          first_name: decoded.given_name,
          last_name: decoded.family_name,
          avatar_url: decoded.picture,
        }),
      });

      if (response.ok) {
        // Redirect to dashboard
        navigate('/admin');
      }
    } catch (error) {
      console.error('Google OAuth failed:', error);
    }
  }}
  onError={() => {
    console.log('Login Failed');
  }}
/>
```

**Register Page Update** (`frontend/src/pages/Register.tsx`):
- Same GoogleLogin component as above

#### **Step 5: Backend Route Registration**

**Check that OAuth routes are registered** (`backend/app/main.py`):
```python
from app.auth.oauth import router as oauth_router

app.include_router(oauth_router, prefix="/api/v1")
```

#### **Testing OAuth:**
```bash
# 1. Start backend
cd backend
uvicorn app.main:app --reload

# 2. Start frontend
cd frontend
npm run dev

# 3. Navigate to http://localhost:5173/login
# 4. Click "Sign in with Google"
# 5. Complete Google OAuth flow
# 6. Check that user is created/logged in
```

---

## üêõ Known Issues

### Critical: Missing Import in OAuth Backend

**File:** `backend/app/auth/oauth.py`
**Line:** 158
**Issue:** `get_current_user` is used but not imported

**Error:**
```python
@router.post("/google/unlink")
async def unlink_google_account(
    current_user: User = Depends(get_current_user),  # ‚ùå NameError: name 'get_current_user' is not defined
    db: Session = Depends(get_db)
):
```

**Fix Required:**
```python
# Add to imports at top of file:
from app.auth.dependencies import get_current_user
```

**Impact:** Google account unlinking endpoint will fail until this import is added.

---

## üìä Statistics

### Code Changes
- **Files Created:** 2
  - `frontend/src/pages/Register.tsx` (473 lines)
  - `docs/V1.7_RELEASE_NOTES.md` (this file)

- **Files Modified:** 4
  - `backend/app/api/v1/endpoints/blog/public.py`
  - `frontend/src/pages/BlogList.tsx`
  - `frontend/src/components/home/FeaturedCarousel.tsx`
  - `frontend/src/routes/routes.tsx`

- **Lines Added:** ~550
- **Lines Modified:** ~80
- **Bugs Fixed:** 3
- **Features Added:** 1 (registration page)

### Testing Coverage
- ‚úÖ Blog filtering tested with multiple categories
- ‚úÖ Featured carousel tested on mobile (iOS Safari, Android Chrome)
- ‚úÖ Registration form tested with various validation scenarios
- ‚ö†Ô∏è Google OAuth not tested (requires credentials setup)

---

## üöÄ Deployment Checklist

### Before Deploying v1.7:

1. **Blog Filtering:**
   - ‚úÖ No additional steps needed (backend/frontend changes only)

2. **Featured Carousel:**
   - ‚úÖ Clear browser cache (CSS/JS changes)
   - ‚úÖ Test on actual mobile devices (not just browser DevTools)

3. **Registration:**
   - ‚úÖ Verify backend registration endpoint is enabled
   - ‚úÖ Check rate limiting settings (currently 3 registrations/hour per IP)
   - ‚ö†Ô∏è Consider adding email verification before activation
   - ‚ö†Ô∏è Review default user role (`STUDENT` is current default)

4. **Google OAuth (Optional):**
   - ‚è≥ Set up Google Cloud Console project
   - ‚è≥ Add environment variables
   - ‚è≥ Install frontend dependencies
   - ‚è≥ Fix missing import in `oauth.py`
   - ‚è≥ Implement frontend GoogleLogin component
   - ‚è≥ Test OAuth flow end-to-end

---

## üéØ Recommendations for v1.8

### High Priority:
1. **Fix OAuth Import** (5 minutes)
   - Add missing `get_current_user` import
   - Test unlinking endpoint

2. **Admin User Management UI** (2-3 hours)
   - User list page
   - Enable/disable accounts
   - Role assignment
   - Search/filter users

3. **Email Verification** (1-2 hours)
   - Send verification email on registration
   - Require email verification before full account access
   - Resend verification email option

### Medium Priority:
4. **Google OAuth Frontend** (1 hour)
   - Install @react-oauth/google
   - Update Login/Register pages
   - Get Google credentials
   - Test OAuth flow

5. **Password Reset** (2 hours)
   - Forgot password flow
   - Email reset link
   - Reset password page

6. **User Profile Management** (2 hours)
   - View/edit profile page
   - Change password
   - Upload avatar
   - Link/unlink Google account

### Low Priority:
7. **Two-Factor Authentication (2FA)** (4 hours)
8. **Account Deletion** (1 hour)
9. **Login History** (2 hours)

---

## üìù Migration Notes

### Database Changes:
- ‚úÖ No database migrations required for v1.7
- User model already supports all necessary fields

### Environment Variables:
- ‚ö†Ô∏è If enabling Google OAuth, add to `.env`:
  ```env
  GOOGLE_CLIENT_ID=
  GOOGLE_CLIENT_SECRET=
  GOOGLE_REDIRECT_URI=
  ```

### Frontend Dependencies:
- ‚ö†Ô∏è If enabling Google OAuth:
  ```bash
  npm install @react-oauth/google
  npm install jwt-decode
  ```

---

## ‚úÖ Testing Checklist

### Blog Filtering:
- [x] Filter by category via URL parameter
- [x] Filter by tag via URL parameter
- [x] Search posts by text
- [x] Pagination works with filters
- [x] "Clear Filters" button works
- [x] Category count displays correctly

### Featured Carousel Mobile:
- [x] Smooth transitions on iOS Safari
- [x] Smooth transitions on Android Chrome
- [x] Buttons don't jump during animation
- [x] Touch controls work properly
- [x] Auto-play functions correctly
- [x] Dot indicators clickable

### Registration:
- [x] Email validation works
- [x] Username validation works (alphanumeric + hyphens/underscores)
- [x] Password requirements enforced
- [x] Confirm password matching
- [x] Real-time validation feedback
- [x] Success redirect to login
- [x] Error messages display correctly
- [x] Dark mode styling correct

### Google OAuth (Pending):
- [ ] Google login button appears
- [ ] OAuth flow redirects correctly
- [ ] New user created with Google data
- [ ] Existing user linked by email
- [ ] Avatar synced from Google
- [ ] Email marked as verified
- [ ] Unlinking works (with password set)

---

## üìÑ Version History

- **v1.7** (2026-01-10): Blog filtering fix, mobile animation fix, registration page
- **v1.6**: Security hardening (previous version)
- **v1.5** and earlier: See previous release notes

---

**Questions or Issues?**
Contact: Andy Naisbitt
Repository: https://github.com/andynaisbitt/fastreactcms
